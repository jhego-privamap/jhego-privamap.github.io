(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"07a4":function(e,t,i){"use strict";i("ac6a"),i("cadf"),i("06db"),i("5df3"),i("f400");var o=i("2b0e"),a=i("2f62");o["a"].use(a["a"]),t["a"]=new a["a"].Store({state:{importedDataGeoJSON:null,isImageEditor:!1,isShapesEditor:!1,isPolylineEditor:!1,imageLayers:[],modifyImageById:null,isInfoPanelDisplayed:!1,isRouteLevel:!1,selectedRouteDirection:2,routesList:new Map,thresholdsList:new Map,editableLayers:[],selectedElementType:null,deletedElements:{points:[],routes:[],landings:[]},elementTypes:[]},mutations:{setImportedDataGeoJSON:function(e,t){e.importedDataGeoJSON=t},setImageEditor:function(e,t){e.isImageEditor=t},setShapesEditor:function(e,t){e.isShapesEditor=t},setRouteEditor:function(e,t){e.isPolylineEditor=t},setImageLayers:function(e,t){e.imageLayers=t},setModifyImageById:function(e,t){e.modifyImageById=t},setInfoPanelDisplayed:function(e,t){e.isInfoPanelDisplayed=t},setRouteLevel:function(e,t){e.isRouteLevel=t},setSelectedRouteDirection:function(e,t){console.log("setSelectedRouteDirection triggered with"),console.log(t),e.selectedRouteDirection=t},setRoutesList:function(e,t){e.routesList=t},setThresholdsList:function(e,t){e.thresholdsList=t},setEditableLayers:function(e,t){e.editableLayers=t},setSelectedElementType:function(e,t){console.log("setSelectedElementType triggered with"),console.log(t),e.selectedElementType=t},setDeletedElements:function(e,t){console.log("setDeletedElements triggered with"),console.log(t),e.deletedElements=t},setElementTypes:function(e,t){console.log("setElementTypes triggered with"),console.log(t),e.elementTypes=t}}})},"0e66":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{staticClass:"map-page"},[i("div",{staticClass:"row"},[i("div",{class:e.isInfoPanelDisplayed?"smallMap":"largeMap"},[i("map-component")],1),e.isInfoPanelDisplayed?i("div",{staticClass:"infoColumn"},[e.isRouteLevel?e._e():i("information-card"),e.isRouteLevel?i("route-information-card"):e._e()],1):e._e()])])},a=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{staticClass:"flex map-component",attrs:{sync:""}},[i("q-card",{staticStyle:{flex:"1"},attrs:{id:"map"}},[i("div",{class:e.isImageEditor?"mapImageEditor":"mapFull",attrs:{oncontextmenu:"return false;"}},[i("l-map",{ref:"map",staticClass:"description mapContainer",attrs:{zoom:e.zoom,center:e.center,options:{zoomControl:!1}},on:{"update:zoom":e.zoomUpdated,"update:center":e.centerUpdated,"update:bounds":e.boundsUpdated}},[i("l-control-zoom",{attrs:{position:"topleft"}}),i("l-control-layers",{ref:"control",attrs:{position:"topleft",autoZIndex:!1}}),e._l(e.tileProviders,(function(e){return i("l-tile-layer",{key:e.name,attrs:{name:e.name,visible:e.visible,options:e.options,url:e.url,attribution:e.attribution,"layer-type":"base"}})})),i("l-control-scale",{attrs:{position:"bottomleft",imperial:!1,metric:!0}})],2)],1),i("q-inner-loading",{attrs:{showing:e.isLoading}},[i("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1),i("q-list",{staticStyle:{"min-width":"100px",visibility:"hidden"},attrs:{id:"contextMenu"}},[e.isSelectAvailable?i("q-item",{attrs:{clickable:""}},[i("q-item-section",{on:{click:e.rightClickSelectVertex}},[e._v("Sélectionner")])],1):e._e(),e.isSelectAvailable?i("q-item",{attrs:{clickable:""}},[i("q-item-section",{on:{click:e.rightClickCreateLine}},[e._v("Relier au point sélectionné")])],1):e._e(),e.isUnselectAvailable?i("q-item",{attrs:{clickable:""}},[i("q-item-section",{on:{click:e.rightClickUnselectVertex}},[e._v("Déselectionner")])],1):e._e()],1),e.isImageEditor||e.isShapesEditor?e._e():i("q-fab",{staticStyle:{position:"absolute",bottom:"30px",right:"8px"},attrs:{square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"img:statics/action.png",direction:"up"}},[i("q-fab-action",{attrs:{square:"",padding:"xs","external-label":"",color:"white","text-color":"mapButton",icon:"img:statics/action.png"},on:{click:function(t){return e.centerMap()}}}),i("q-fab-action",{attrs:{square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"image"},on:{click:function(t){return e.importImage()}}}),i("q-fab-action",{attrs:{square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"alarm"}}),i("q-fab-action",{attrs:{square:"",padding:"xs","external-label":"",color:"white","text-color":"mapButton",icon:"airplay"}})],1),e.isImageEditor?i("q-btn",{staticStyle:{position:"absolute",bottom:"82px",right:"8px"},attrs:{"external-label":"",square:"",padding:"xs",color:"mapButton",icon:"clear"},on:{click:function(t){return e.cancelModification()}}}):e._e(),e.isImageEditor?i("q-btn",{staticStyle:{position:"absolute",bottom:"40px",right:"8px"},attrs:{"external-label":"",square:"",padding:"xs",color:"mapButton",icon:"done"},on:{click:function(t){return e.confirmImage()}}}):e._e(),i("q-btn-group",{staticClass:"floating-btn-group",staticStyle:{position:"absolute",top:"10px",right:"10px"}},[e.isRouteLevel&&e.isPolylineEditorAdd?i("q-btn",{staticClass:"floating-btn confirm-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-check"},on:{click:function(t){return e.cancelAddPolyline()}}}):e._e(),e.isRouteLevel?i("q-btn",{staticClass:"floating-btn add-polyline-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"timeline"},on:{click:function(t){return e.addPolyline()}}}):e._e()],1),i("q-btn-group",{staticClass:"floating-btn-group",staticStyle:{position:"absolute",top:"57px",right:"10px"}},[e.isRouteLevel&&e.isPolylineEditorCrossroad?i("q-btn",{staticClass:"floating-btn confirm-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-check"},on:{click:function(t){return e.cancelAddCrossroad()}}}):e._e(),e.isRouteLevel?i("q-btn",{staticClass:"floating-btn icon-crossroad",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton"},on:{click:function(t){return e.addCrossroad()}}}):e._e()],1),i("q-btn-group",{staticClass:"floating-btn-group",staticStyle:{position:"absolute",top:"104px",right:"10px"}},[e.isRouteLevel&&e.isPolylineEditorThreshold?i("q-btn",{staticClass:"floating-btn confirm-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-check"},on:{click:function(t){return e.cancelAddThreshold()}}}):e._e(),e.isRouteLevel?i("q-btn",{staticClass:"floating-btn add-threshold-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"mdi-anchor"},on:{click:function(t){return e.addThreshold()}}}):e._e()],1),i("q-btn-group",{staticClass:"floating-btn-group",staticStyle:{position:"absolute",top:"10px",right:"10px"}},[e.isShapesEditor&&e.isPolygonEditorAdd?i("q-btn",{staticClass:"floating-btn undo-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"mdi-undo-variant"},on:{click:function(t){return e.removeLastVertexPolygon()}}}):e._e(),e.isShapesEditor&&e.isPolygonEditorAdd?i("q-btn",{staticClass:"floating-btn confirm-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-check"},on:{click:function(t){return e.confirmAddPolygon()}}}):e._e(),e.isShapesEditor&&e.isPolygonEditorAdd?i("q-btn",{staticClass:"floating-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-times"},on:{click:function(t){return e.cancelAddPolygon()}}}):e._e(),e.isShapesEditor?i("q-btn",{staticClass:"floating-btn add-polygon-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"mdi-shape-polygon-plus"},on:{click:function(t){return e.addPolygon()}}}):e._e()],1),i("q-btn-group",{staticClass:"floating-btn-group",staticStyle:{position:"absolute",top:"57px",right:"10px"}},[e.isShapesEditor&&e.isMarkerEditorAdd?i("q-btn",{staticClass:"floating-btn confirm-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-check"},on:{click:function(t){return e.cancelAddMarker()}}}):e._e(),e.isShapesEditor?i("q-btn",{staticClass:"floating-btn add-marker-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"mdi-map-marker-plus"},on:{click:function(t){return e.addMarker()}}}):e._e()],1),i("q-btn-group",{class:e.isRouteLevel?"floating-btn-group modify-polygon route-level":"floating-btn-group modify-polygon"},[(e.isShapesEditor||e.isRouteLevel)&&e.isPolygonEditorMod?i("q-btn",{staticClass:"floating-btn confirm-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-check"},on:{click:function(t){return e.confirmModPolygon()}}}):e._e(),(e.isShapesEditor||e.isRouteLevel)&&e.isPolygonEditorMod?i("q-btn",{staticClass:"floating-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-times"},on:{click:function(t){return e.cancelModPolygon()}}}):e._e(),e.isShapesEditor||e.isRouteLevel?i("q-btn",{staticClass:"floating-btn edit-btn",attrs:{disabled:e.isEditable,"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-pen"},on:{click:function(t){return e.editPolygon()}}}):e._e()],1),i("q-btn-group",{class:e.isRouteLevel?"floating-btn-group delete-polygon route-level":"floating-btn-group delete-polygon"},[(e.isShapesEditor||e.isRouteLevel)&&e.isPolygonEditorDel?i("q-btn",{staticClass:"floating-btn confirm-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-check"},on:{click:function(t){return e.confirmDelPolygon()}}}):e._e(),(e.isShapesEditor||e.isRouteLevel)&&e.isPolygonEditorDel?i("q-btn",{staticClass:"floating-btn",attrs:{"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-times"},on:{click:function(t){return e.cancelDelPolygon()}}}):e._e(),e.isShapesEditor||e.isRouteLevel?i("q-btn",{staticClass:"floating-btn edit-btn",attrs:{disabled:e.isEditable,"external-label":"",square:"",padding:"xs",color:"white","text-color":"mapButton",icon:"fas fa-trash-alt"},on:{click:function(t){return e.deletePolygon()}}}):e._e()],1),e.isImageEditor?i("q-item",{staticClass:"sliderOpacity"},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"primary",name:"opacity"}})],1),i("q-item-section",[i("q-slider",{attrs:{min:0,max:1,step:.01,dense:"",color:"primary"},on:{input:e.onOpacityChange},model:{value:e.opacity,callback:function(t){e.opacity=t},expression:"opacity"}})],1)],1):e._e()],1),i("import-dialog",{attrs:{dialogOptions:e.dialogImageOptions},on:{importedData:e.loadImage}})],1)},n=[],r=(i("6b54"),i("7f7f"),i("6762"),i("2fdb"),i("1c4c"),i("ac6a"),i("cadf"),i("06db"),i("5df3"),i("f400"),i("2699")),l=i("a40a"),d=i("d371"),c=i("9ee8"),h=i("c8b6"),p=i("e11e"),g=i.n(p),m=i("feb7"),u=i("aeff"),y=i.n(u),L=i("b24d"),f=i.n(L),I=i("32ef"),b=i.n(I),M=i("4596"),C=i.n(M),w=i("3b38"),T=i("260b"),v=i("8f76"),E=i.n(v),x=i("f3f3"),S=i.n(x),A=i("792c"),D=i.n(A),k=i("2ef0");i("20d6b"),i("6cc5"),i("5fbf");g.a.ImageOverlay.Rotated=g.a.ImageOverlay.extend({initialize:function(e,t,i,o,a){"string"===typeof e?this._url=e:this._rawImage=e,this._topLeft=g.a.latLng(t),this._topRight=g.a.latLng(i),this._bottomLeft=g.a.latLng(o),g.a.setOptions(this,a)},onAdd:function(e){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(g.a.DomUtil.addClass(this._rawImage,"leaflet-interactive"),this.addInteractiveTarget(this._rawImage)),e.on("zoomend resetview",this._reset,this),this.getPane().appendChild(this._image),this._reset()},onRemove:function(e){e.off("zoomend resetview",this._reset,this),g.a.ImageOverlay.prototype.onRemove.call(this,e)},_initImage:function(){var e=this._rawImage;this._url&&(e=g.a.DomUtil.create("img"),e.style.display="none",this.options.crossOrigin&&(e.crossOrigin=""),e.src=this._url,this._rawImage=e),g.a.DomUtil.addClass(e,"leaflet-image-layer");var t=this._image=g.a.DomUtil.create("div","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));this._updateZIndex(),t.appendChild(e),t.onselectstart=g.a.Util.falseFn,t.onmousemove=g.a.Util.falseFn,e.onload=function(){this._reset(),e.style.display="block",this.fire("load")}.bind(this),e.alt=this.options.alt},_reset:function(){var e=this._image;if(this._map){var t=this._map.latLngToLayerPoint(this._topLeft),i=this._map.latLngToLayerPoint(this._topRight),o=this._map.latLngToLayerPoint(this._bottomLeft),a=i.subtract(t).add(o),s=g.a.bounds([t,i,o,a]),n=s.getSize(),r=t.subtract(s.min);this._bounds=g.a.latLngBounds(this._map.layerPointToLatLng(s.min),this._map.layerPointToLatLng(s.max)),g.a.DomUtil.setPosition(e,s.min),e.style.width=n.x+"px",e.style.height=n.y+"px";var l=this._rawImage.width,d=this._rawImage.height;if(l&&d){var c=i.subtract(t),h=o.subtract(t);this._rawImage.style.transformOrigin="0 0",this._rawImage.style.transform="matrix("+c.x/l+", "+c.y/l+", "+h.x/d+", "+h.y/d+", "+r.x+", "+r.y+")"}}},reposition:function(e,t,i){this._topLeft=g.a.latLng(e),this._topRight=g.a.latLng(t),this._bottomLeft=g.a.latLng(i),this._reset()},getTopLeft:function(){return this._topLeft},getTopRight:function(){return this._topRight},getBottomLeft:function(){return this._bottomLeft},setUrl:function(e){return this._url=e,this._rawImage&&(this._rawImage.src=e),this}}),g.a.imageOverlay.rotated=function(e,t,i,o,a){return new g.a.ImageOverlay.Rotated(e,t,i,o,a)};i("a8b7");var N=i("07a4"),P=i("e526"),R=(i("f33e"),i("1d2c"),i("cf23")),j=i.n(R),O=i("6af5"),z=i.n(O),G=i("b94f"),Z=i.n(G),_=i("dd31"),B=i.n(_),Y=[{name:"Esri.WorldImagery",visible:!0,attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{maxZoom:22,maxNativeZoom:19}},{name:"GeoportailFrance.orthos",visible:!1,attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',url:"https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/jpeg&LAYER=ORTHOIMAGERY.ORTHOPHOTOS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",options:{maxZoom:22,maxNativeZoom:19}},{name:"GeoportailFrance.maps",visible:!1,attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',url:"https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/jpeg&LAYER=GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.STANDARD&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",options:{maxZoom:22,maxNativeZoom:18}},{name:"GeoportailFrance.ignMaps",visible:!1,attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',url:"https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/jpeg&LAYER=GEOGRAPHICALGRIDSYSTEMS.MAPS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",options:{maxZoom:22,maxNativeZoom:18}},{name:"GeoportailFrance.PlanIGN",visible:!1,attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',url:"https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/png&LAYER=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",options:{maxZoom:22,maxNativeZoom:19}},{name:"OSM",visible:!1,url:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",attribution:'Map data: &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',options:{maxZoom:22,maxNativeZoom:19}},{name:"Stadia",visible:!1,attribution:'&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',url:"https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png",options:{maxZoom:22,maxNativeZoom:20}},{name:"Stamen",visible:!1,attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}{r}.png",options:{maxZoom:22,maxNativeZoom:20}}],W={components:{LMap:r["a"],LTileLayer:l["a"],LControlScale:d["a"],LControlLayers:c["a"],LControlZoom:h["a"],"import-dialog":P["a"]},data:function(){return{map:null,defaultIcon:new g.a.Icon({iconUrl:j.a,iconSize:[27,45],iconAnchor:[15,40]}),selectedIcon:new g.a.Icon({iconUrl:z.a,iconSize:[27,45],iconAnchor:[15,40]}),zoom:15,center:g.a.latLng(50.22063232981847,3.172990350766831),tileProviders:Y,editedImageLayer:null,newImageCoord:[[50.22401551627046,3.158713465189201],[50.22401551627046,3.179662195391103],[50.2179704881745,3.17919547894098],[50.21872742410591,3.158246748739078]],imHeight:null,imWeight:null,imDiag:null,imageLayers:[],modImageMarker1:null,modImageMarker2:null,circleOptions:{steps:100,units:"kilometers",properties:{}},opacity:1,anchor1ToTopRightNormedDist:0,anchor1ToBottomLeftNormedDist:0,anchor1ToTopLeftNormedDist:0,anchor1ToBottomRightNormedDist:0,anchor2ToTopRightNormedDist:0,anchor2ToBottomLeftNormedDist:0,anchor2ToTopLeftNormedDist:0,anchor2ToBottomRightNormedDist:0,distBetweenAnchorsNormed:0,imScale:1,anchor1InUpperLeftCorner:!0,anchor2InUpperLeftCorner:!0,precision:.01,store:N["a"],buildingLayer:null,buildingStyle:{color:"#ff7800",weight:5,opacity:.65},ratio:1,dialogImageOptions:{},imageFile:null,newImage:null,imageList:[],isLoading:!1,editedImageInd:null,isShapesEditor:!1,layerControl:null,drawPluginOptions:null,circleMarkerEditorAdd:null,isPolylineEditorAdd:!1,isMarkerEditorAdd:!1,isPolylineEditorCrossroad:!1,isPolylineEditorThreshold:!1,polygonEditorAdd:null,isPolygonEditorAdd:!1,polygonEditorMod:null,isPolygonEditorMod:!1,polygonEditorDel:null,isPolygonEditorDel:!1,editableLayers:null,isEditable:!1,lastPolylineVertexId:null,linesList:new Map,backupLinesList:null,linesLastId:-1,pointsList:new Map,backupPointsList:new Map,thresholdsList:new Map,isContextMenu:!1,rightClickedVertex:null,isUnselectAvailable:!1,isSelectAvailable:!1,draftLayer:null,midpointsLayer:null,backupEditableLayers:null,selectedLineLayer:null,isRouteSelected:!1,dirArrowsLayer:null,selectedLine:null,crossroadLayer:null,centerOfMassLayer:null,thresholdLinesLayer:null,selectedElementCenter:null,eltsIdDictByDef:new Map,backupThresholdsList:null,backupThresholdLinesLayer:null,backupDeletedElements:null}},created:function(){},mounted:function(){var e=this;this.map=this.$refs.map.mapObject,this.buildingLayer=g.a.geoJSON(),this.buildingLayer.addTo(this.map),this.thresholdLinesLayer=new g.a.FeatureGroup,this.thresholdLinesLayer.on("click",this.onClickThreshold),this.map.addLayer(this.thresholdLinesLayer),this.linesLayers=new g.a.FeatureGroup,this.linesLayers.on("click",this.onLineClick),this.map.addLayer(this.linesLayers),this.centerOfMassLayer=new g.a.FeatureGroup,this.map.addLayer(this.centerOfMassLayer),this.selectedLineLayer=new g.a.FeatureGroup,this.map.addLayer(this.selectedLineLayer),this.selectedLineLayer.setStyle({color:"#61C1D2"}),this.draftLayer=new g.a.FeatureGroup,this.map.addLayer(this.draftLayer),this.dirArrowsLayer=new g.a.FeatureGroup,this.map.addLayer(this.dirArrowsLayer),this.midpointsLayer=new g.a.FeatureGroup,this.midpointsLayer.on("mouseover",this.onHoverMidpoint),this.midpointsLayer.on("mouseout",this.onHoverEndMidpoint),this.midpointsLayer.on("click",this.onClickMidpoint),this.map.addLayer(this.midpointsLayer),this.crossroadLayer=new g.a.FeatureGroup,this.crossroadLayer.on("mouseover",this.onHoverCrossroad),this.crossroadLayer.on("mouseout",this.onHoverEndCrossroad),this.crossroadLayer.on("click",this.onClickCrossroad),this.map.addLayer(this.crossroadLayer),this.editableLayers=new g.a.FeatureGroup,this.editableLayers.on("click",this.onClickEditableLayer),this.editableLayers.on("contextmenu",this.onPointRightClick),this.map.addLayer(this.editableLayers),this.drawPluginOptions={draw:{polygon:{allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!"},shapeOptions:{color:"#61C1D2"},repeatMode:!0},circlemarker:{radius:8,fillColor:"#61C1D2",color:"#2F52A0",weight:2,opacity:1,fillOpacity:.8,repeatMode:!0}},edit:{featureGroup:this.editableLayers,remove:!0}},g.a.drawLocal.draw.handlers.circlemarker.tooltip={start:"Cliquer pour placer les points de route."},g.a.drawLocal.draw.handlers.polygon.tooltip={start:"Cliquer pour commencer à dessiner une forme.",cont:"Cliquer pour continuer à dessiner la forme.",end:"Cliquer sur le premier point pour fermer la forme."},g.a.drawLocal.edit.handlers.edit.tooltip={text:"Appuyer sur la croix pour annuler les modifications.",subtext:"Faire glisser les points pour les déplacer."},g.a.drawLocal.edit.handlers.remove.tooltip={text:"Cliquer sur un élément pour le retirer."};var t=this;this.map.on("draw:created",(function(e){var i=e.layerType,o=e.layer;t.editableLayers.addLayer(o),"circlemarker"===i?(o.on("click",t.onPointClick),t.drawLineToLastVertex(o._leaflet_id)):"polygon"===i&&(console.log("page.selectedElementType.value.id"),console.log(t.selectedElementType.value.id),o.options.typeId=t.selectedElementType.value.id)})),this.map.on("draw:deleted",(function(e){t.editableLayers.getLayers().length?t.isEditable=!1:t.isEditable=!0})),this.map.on("draw:editmove",(function(e){if(t.editPoint(e.layer._leaflet_id),t.selectedLine){var i=t.selectedLineLayer.getLayers()[0];if(i.options.point1===e.layer._leaflet_id||i.options.point2===e.layer._leaflet_id){var o=g.a.polyline([t.editableLayers._layers[i.options.point1]._latlng,t.editableLayers._layers[i.options.point2]._latlng],{color:"#61C1D2",id:i.options.id,direction:i.options.direction,point1:i.options.point1,point2:i.options.point2});t.selectedLineLayer.clearLayers(),t.selectedLineLayer.addLayer(o)}}})),this.map.on("mousemove",(function(e){(t.isPolylineEditorAdd&&t.lastPolylineVertexId||t.isPolylineEditorThreshold&&t.selectedElementCenter)&&t.draftLineToMouse(e)})),this.map.on("click",(function(e){t.isContextMenu=!1})),this.$nextTick((function(){e.addOverlays(),e.displayImages(),e.displayElements()})),this.polygonEditorAdd=new g.a.Draw.Polygon(this.map,this.drawPluginOptions.draw.polygon),this.circleMarkerEditorAdd=new g.a.Draw.CircleMarker(this.map,this.drawPluginOptions.draw.circlemarker),this.polygonEditorMod=new g.a.EditToolbar.Edit(this.map,{featureGroup:this.drawPluginOptions.edit.featureGroup,selectedPathOptions:this.drawPluginOptions.edit.selectedPathOptions}),this.polygonEditorDel=new g.a.EditToolbar.Delete(this.map,{featureGroup:this.drawPluginOptions.edit.featureGroup}),this.$nextTick((function(){e.displayRoutes()}))},beforeDestroy:function(){},computed:{selectedRouteDirection:function(){return this.store.state.selectedRouteDirection},importedDataGeoJSON:function(){return this.store.state.importedDataGeoJSON},modifyImageById:function(){return this.store.state.modifyImageById},isShapeEditorMode:function(){return this.store.state.isShapesEditor},isRouteLevel:function(){return this.store.state.isRouteLevel},selectedElementType:function(){return this.store.state.selectedElementType},isInfoPanelDisplayed:function(){return this.isPolylineEditorAdd||this.isRouteSelected},isImageEditor:{get:function(){return this.store.state.isImageEditor},set:function(e){this.store.commit("setImageEditor",e)}},deletedElements:{get:function(){return this.store.state.deletedElements},set:function(e){this.store.commit("setDeletedElements",e)}},elementTypes:{get:function(){return this.store.state.elementTypes},set:function(e){this.store.commit("setElementTypes",e)}}},watch:{isInfoPanelDisplayed:function(e){this.store.commit("setInfoPanelDisplayed",e)},isContextMenu:function(e){document.getElementById("contextMenu").style.visibility=e?"visible":"hidden"},importedDataGeoJSON:function(e){var t=JSON.parse(this.store.state.importedDataGeoJSON);this.map.removeLayer(this.buildingLayer),this.buildingLayer=g.a.geoJSON(t,this.buildingStyle).addTo(this.map),this.store.commit("setInfoPanelDisplayed",!0)},imageLayers:function(e){this.store.commit("setImageLayers",e)},modifyImageById:function(e){this.isImageEditor=!0;for(var t=0;t<this.imageLayers.length;t++)if(this.imageLayers[t].id===e){this.editedImageInd=t;break}this.editedImageLayer=this.imageLayers[this.editedImageInd].layer,this.editImage()},isShapeEditorMode:function(e){this.isShapesEditor=e,e?this.addPolygon():(this.cancelAddPolygon(),this.cancelModPolygon(),this.cancelDelPolygon()),this.store.commit("setInfoPanelDisplayed",e)},isRouteLevel:function(e){e?this.addPolyline():(this.cancelAddPolyline(),this.cancelModPolygon(),this.cancelDelPolygon()),this.store.commit("setInfoPanelDisplayed",e),this.editableLayers.getLayers().length?this.isEditable=!1:this.isEditable=!0},selectedRouteDirection:function(e){if(this.isRouteSelected){var t=this.selectedLineLayer.getLayers()[0];this.linesList.get(t.options.id).direction=e,this.linesLayers.removeLayer(this.selectedLine);var i=new Map;i.set(t.options.id,this.linesList.get(t.options.id)),this.drawLines(i)}}},methods:{zoomUpdated:function(e){this.zoom=e},centerUpdated:function(e){this.center=e},boundsUpdated:function(e){this.bounds=e},importImage:function(){this.dialogImageOptions={placeholder:"Image File",acceptedFormats:".jpg, image/*"}},loadImage:function(e){var t=this;this.isLoading=!0,this.isImageEditor=!0,this.imageFile=e,this.newImage=new Image,this.newImage.onload=this.addImage;var i=new FileReader;i.addEventListener("load",(function(e){t.importedData=e.target.result,t.newImage.src=t.importedData})),i.readAsDataURL(e)},addImage:function(){this.ratio=this.newImage.naturalHeight/this.newImage.naturalWidth;var e=g.a.latLng(this.newImageCoord[0]).distanceTo(g.a.latLng(this.newImageCoord[1]))*this.ratio,t=Object(m["lineString"])([[this.newImageCoord[0][1],this.newImageCoord[0][0]],[this.newImageCoord[0][1],this.newImageCoord[0][0]-10]]),i=y()(t,e/1e3,{units:"kilometers"});this.newImageCoord[3]=[i.geometry.coordinates[1],i.geometry.coordinates[0]],this.newImageCoord[2]=[this.newImageCoord[3][0],this.newImageCoord[0][1]];var o=g.a.latLng(this.newImageCoord[0]),a=g.a.latLng(this.newImageCoord[1]),s=g.a.latLng(this.newImageCoord[3]);this.editedImageLayer=g.a.imageOverlay.rotated(this.newImage,o,a,s,{opacity:this.opacity,interactive:!0}),this.editedImageLayer.addTo(this.map),this.editImage(),this.isLoading=!1},confirmImage:function(){var e=this;this.isLoading=!0;var t,i,o=this.editedImageLayer.getTopRight(),a=this.editedImageLayer.getBottomLeft(),s=this.editedImageLayer.getTopLeft(),n=this.getBottomRightCorner(o,a);if(null===this.editedImageInd){t="https://privamap-dev.azurewebsites.net/api/imageLayer/"+s.lat+"/"+s.lng+"/"+o.lat+"/"+o.lng+"/"+a.lat+"/"+a.lng+"/"+n.lat+"/"+n.lng+"/0";var r=new FormData;r.append("file",this.imageFile),i={method:"POST",body:r,redirect:"follow"}}else t="https://privamap-dev.azurewebsites.net/api/imageLayer/coords/"+this.imageLayers[this.editedImageInd].id+"/"+s.lat+"/"+s.lng+"/"+o.lat+"/"+o.lng+"/"+a.lat+"/"+a.lng+"/"+n.lat+"/"+n.lng+"/0",i={method:"PUT",redirect:"follow"};var l=0;fetch(t,i).then((function(e){if(!e.ok)throw Error(e.statusText);return e.text()})).then((function(t){null===e.editedImageInd?(l=JSON.parse(t).id,e.imageLayers.push({id:l,layer:e.editedImageLayer})):e.imageLayers[e.editedImageInd].layer=e.editedImageLayer,e.editedImageLayer=null,e.editedImageInd=null,e.modImageMarker1.remove(),e.modImageMarker2.remove(),e.isImageEditor=!1,e.isLoading=!1})).catch((function(t){console.log("error",t),e.$q.notify({type:"negative",message:"Error while uploading file"}),e.isLoading=!1}))},cancelModification:function(){var e=this;if(null===this.editedImageInd)this.editedImageLayer.remove(),this.editedImageLayer=null;else{var t="https://privamap-dev.azurewebsites.net/api/imageLayer/"+this.imageLayers[this.editedImageInd].id,i={method:"GET",redirect:"follow"};fetch(t,i).then((function(e){return e.text()})).then((function(t){var i=JSON.parse(t),o=[parseFloat(i.topLeftLat),parseFloat(i.topLeftLng)],a=[parseFloat(i.topRightLat),parseFloat(i.topRightLng)],s=[parseFloat(i.bottomLeftLat),parseFloat(i.bottomLeftLng)];e.editedImageLayer.reposition(o,a,s),e.editedImageLayer=null})).catch((function(e){return console.log("error",e)}))}this.modImageMarker1.remove(),this.modImageMarker2.remove(),this.editedImageInd=null,this.isImageEditor=!1},onDragMarker1:function(){if(!this.isMoveAnchorPoint1){var e=this.getImagePosition(),t=e[0],i=e[1],o=e[2];this.editedImageLayer.reposition(t,i,o)}},onDragMarker2:function(){if(!this.isMoveAnchorPoint2){var e=this.getImagePosition(),t=e[0],i=e[1],o=e[2];this.editedImageLayer.reposition(t,i,o)}},onDragEndMarker1:function(){if(this.isMoveAnchorPoint1){var e=this.modImageMarker1.getLatLng(),t=this.editedImageLayer.getTopRight(),i=this.editedImageLayer.getBottomLeft(),o=this.editedImageLayer.getTopLeft(),a=this.getBottomRightCorner(t,i),s=t.distanceTo(i);this.imScale=s/this.imDiag,this.anchor1ToTopRightNormedDist=t.distanceTo(e)/this.imScale,this.anchor1ToBottomLeftNormedDist=i.distanceTo(e)/this.imScale,this.anchor1ToTopLeftNormedDist=o.distanceTo(e)/this.imScale,this.anchor1ToBottomRightNormedDist=a.distanceTo(e)/this.imScale,this.distBetweenAnchorsNormed=this.modImageMarker2.getLatLng().distanceTo(e)/this.imScale;var n=[V(o),V(t),V(i)],r={type:"Polygon",coordinates:[n]},l=C()(V(e),r);this.anchor1InUpperLeftCorner=l}},onDragEndMarker2:function(){if(this.isMoveAnchorPoint2){var e=this.modImageMarker2.getLatLng(),t=this.editedImageLayer.getTopRight(),i=this.editedImageLayer.getBottomLeft(),o=this.editedImageLayer.getTopLeft(),a=this.getBottomRightCorner(t,i),s=t.distanceTo(i);this.imScale=s/this.imDiag,this.anchor2ToTopRightNormedDist=t.distanceTo(e)/this.imScale,this.anchor2ToBottomLeftNormedDist=i.distanceTo(e)/this.imScale,this.anchor2ToTopLeftNormedDist=o.distanceTo(e)/this.imScale,this.anchor2ToBottomRightNormedDist=a.distanceTo(e)/this.imScale,this.distBetweenAnchorsNormed=this.modImageMarker1.getLatLng().distanceTo(e)/this.imScale;var n=[V(o),V(t),V(i)],r={type:"Polygon",coordinates:[n]},l=C()(V(e),r);this.anchor2InUpperLeftCorner=l}},onOpacityChange:function(){this.editedImageLayer.setOpacity(this.opacity)},onClickMarker1:function(){this.isMoveAnchorPoint1=!this.isMoveAnchorPoint1,this.isMoveAnchorPoint1?(this.modImageMarker1.setIcon(this.selectedIcon),this.isMoveAnchorPoint2=!1):this.modImageMarker1.setIcon(this.defaultIcon)},onClickMarker2:function(){this.isMoveAnchorPoint2=!this.isMoveAnchorPoint2,this.isMoveAnchorPoint2?(this.modImageMarker2.setIcon(this.selectedIcon),this.isMoveAnchorPoint1=!1):this.modImageMarker2.setIcon(this.defaultIcon)},getPointsFromDist:function(e,t,i,o){if(0===i)return[e];if(0===o)return[t];for(var a=b()(V(e),i/1e3,this.circleOptions).geometry.coordinates[0],s=b()(V(t),o/1e3,this.circleOptions).geometry.coordinates[0],n=f()(Object(m["lineString"])(a),Object(m["lineString"])(s)),r=[],l=0;l<n.features.length;l++)r[l]=F(n.features[l].geometry.coordinates);return r},getTopLeftCorner:function(e,t){var i=Object(w["a"])(Object(m["point"])(V(e)),Object(m["point"])(V(t)));i=i.geometry;var o={pivot:i},a=Object(m["point"])(V(t)),s=Object(T["a"])(a,2*Math.atan(this.imHeight/this.imWeight)/Math.PI*180,o);return s=F(s.geometry.coordinates),s},getBottomRightCorner:function(e,t){var i=Object(w["a"])(Object(m["point"])(V(e)),Object(m["point"])(V(t)));i=i.geometry;var o={pivot:i},a=Object(m["point"])(V(e)),s=Object(T["a"])(a,2*Math.atan(this.imHeight/this.imWeight)/Math.PI*180,o);return s=F(s.geometry.coordinates),s},getImagePosition:function(){var e=this.modImageMarker1.getLatLng(),t=this.modImageMarker2.getLatLng(),i=t.distanceTo(e);this.imScale=i/this.distBetweenAnchorsNormed;var o,a,s,n=this.getPointsFromDist(e,t,this.anchor1ToTopRightNormedDist*this.imScale,this.anchor2ToTopRightNormedDist*this.imScale),r=this.getPointsFromDist(e,t,this.anchor1ToBottomLeftNormedDist*this.imScale,this.anchor2ToBottomLeftNormedDist*this.imScale),l=[];if(n.forEach((function(e){r.forEach((function(t){l.push([e,t])}))})),l.length>1&&(l=this.filterByDiagLength(l)),1===l.length)o=g.a.latLng(l[0][0]),s=g.a.latLng(l[0][1]);else if(l.length>1)if(l=this.filterByAreaCheck(l),1===l.length)a=g.a.latLng(l[0][0]),o=g.a.latLng(l[0][1]),s=g.a.latLng(l[0][3]);else if(l.length>1){var d=this.filterByDistToCorners(l);a=d[0],o=d[1],s=d[2]}return a||(a=this.getTopLeftCorner(g.a.latLng(o),g.a.latLng(s))),[a,o,s]},filterByDiagLength:function(e){for(var t=[],i=[],o=0;o<e.length;o++){var a=e[o],s=a[0],n=a[1],r=s.distanceTo(n)/this.imScale,l=Math.abs(r/this.imDiag-1);i.push(l),l<=this.precision&&t.push(a)}if(!t.length){var d=Math.min.apply(Math,i),c=i.indexOf(d);t.push(e[c])}return t},filterByAreaCheck:function(e){for(var t,i,o,a,s=this.modImageMarker1.getLatLng(),n=this.modImageMarker2.getLatLng(),r=[],l=0;l<e.length;l++){var d=e[l];t=g.a.latLng(d[0]),i=g.a.latLng(d[1]),a=this.getTopLeftCorner(t,i);var c=!1,h=!1,p=[V(a),V(t),V(i)],m={type:"Polygon",coordinates:[p]};if(this.anchor1InUpperLeftCorner){var u=C()(V(s),m);if(!u)continue;c=!0}if(this.anchor2InUpperLeftCorner){var y=C()(V(n),m);if(!y)continue;if(c){r.push([a,t,o,i]);continue}h=!0}o=this.getBottomRightCorner(t,i);var L=[V(o),V(t),V(i)],f={type:"Polygon",coordinates:[L]};if(!this.anchor1InUpperLeftCorner){var I=C()(V(s),f);if(!I)continue;if(h){r.push([a,t,o,i]);continue}c=!0}if(!this.anchor2InUpperLeftCorner){var b=C()(V(n),f);b&&c&&r.push([a,t,o,i])}}return r},filterByDistToCorners:function(e){for(var t,i,o,a,s,n,r,l=this.modImageMarker1.getLatLng(),d=this.modImageMarker2.getLatLng(),c=[],h=0;h<e.length;h++){var p=e[h];a=g.a.latLng(p[0]),t=g.a.latLng(p[1]),o=g.a.latLng(p[2]),i=g.a.latLng(p[3]),a||(a=this.getTopLeftCorner(g.a.latLng(t),g.a.latLng(i)));var m=l.distanceTo(a)/this.imScale,u=d.distanceTo(a)/this.imScale;o||(o=this.getBottomRightCorner(g.a.latLng(t),g.a.latLng(i)));var y=l.distanceTo(o)/this.imScale,L=d.distanceTo(o)/this.imScale,f=Math.abs(m/this.anchor1ToTopLeftNormedDist-1),I=Math.abs(u/this.anchor2ToTopLeftNormedDist-1),b=Math.abs(y/this.anchor1ToBottomRightNormedDist-1),M=Math.abs(L/this.anchor2ToBottomRightNormedDist-1),C=f+I+b+M;c.push(C)}var w=Math.min.apply(Math,c),T=c.indexOf(w);return s=g.a.latLng(e[T][0]),n=g.a.latLng(e[T][1]),r=g.a.latLng(e[T][3]),[s,n,r]},editImage:function(){var e=this.editedImageLayer.getTopRight(),t=this.editedImageLayer.getBottomLeft(),i=this.editedImageLayer.getTopLeft();this.imWeight=i.distanceTo(e),this.imHeight=t.distanceTo(i),this.imDiag=t.distanceTo(e),this.modImageMarker1=new g.a.Marker(e,{draggable:"true",icon:this.defaultIcon}),this.modImageMarker1.addTo(this.map),this.modImageMarker1.on("drag",this.onDragMarker1),this.modImageMarker1.on("dragend",this.onDragEndMarker1),this.modImageMarker1.on("click",this.onClickMarker1),this.modImageMarker2=new g.a.Marker(t,{draggable:"true",icon:this.defaultIcon}),this.modImageMarker2.addTo(this.map),this.modImageMarker2.on("drag",this.onDragMarker2),this.modImageMarker2.on("dragend",this.onDragEndMarker2),this.modImageMarker2.on("click",this.onClickMarker2),this.anchor1ToTopRightNormedDist=0,this.anchor1ToBottomLeftNormedDist=this.imDiag,this.anchor1ToTopLeftNormedDist=this.imWeight,this.anchor1ToBottomRightNormedDist=this.imHeight,this.anchor2ToTopRightNormedDist=this.imDiag,this.anchor2ToBottomLeftNormedDist=0,this.anchor2ToTopLeftNormedDist=this.imHeight,this.anchor2ToBottomRightNormedDist=this.imWeight,this.distBetweenAnchorsNormed=this.imDiag},addPolyline:function(){this.circleMarkerEditorAdd.enable(),this.isPolylineEditorThreshold?this.cancelAddThreshold():this.isPolylineEditorCrossroad?this.cancelAddCrossroad():this.isPolygonEditorAdd?this.confirmAddPolygon():this.isPolygonEditorMod?this.confirmModPolygon():this.isPolygonEditorDel&&this.confirmDelPolygon(),this.isPolylineEditorAdd=!0},cancelAddPolyline:function(){this.circleMarkerEditorAdd.disable(),this.isPolylineEditorAdd=!1,this.editableLayers.getLayers().length?this.isEditable=!1:this.isEditable=!0,this.unselectVertex(),this.draftLayer.clearLayers()},addMarker:function(){this.circleMarkerEditorAdd.enable(),this.isPolylineEditorAdd?this.cancelAddPolyline():this.isPolygonEditorAdd?this.confirmAddPolygon():this.isPolygonEditorMod?this.confirmModPolygon():this.isPolygonEditorDel&&this.confirmDelPolygon(),this.isMarkerEditorAdd=!0},cancelAddMarker:function(){this.circleMarkerEditorAdd.disable(),this.isMarkerEditorAdd=!1},addPolygon:function(){this.polygonEditorAdd.enable(),this.isMarkerEditorAdd?this.cancelAddMarker():this.isPolygonEditorMod?this.confirmModPolygon():this.isPolygonEditorDel&&this.confirmDelPolygon(),this.isPolygonEditorAdd=!0},cancelAddPolygon:function(){this.polygonEditorAdd.disable(),this.isPolygonEditorAdd=!1},confirmAddPolygon:function(){this.polygonEditorAdd.completeShape(),this.cancelAddPolygon(),this.storeRoutes()},removeLastVertexPolygon:function(){this.polygonEditorAdd.deleteLastVertex()},editPolygon:function(){this.isPolylineEditorAdd?this.cancelAddPolyline():this.isMarkerEditorAdd?this.cancelAddMarker():this.isPolylineEditorCrossroad?this.cancelAddCrossroad():this.isPolylineEditorThreshold?this.cancelAddThreshold():this.isPolygonEditorAdd?this.confirmAddPolygon():this.isPolygonEditorDel&&this.confirmDelPolygon(),this.polygonEditorMod.enable(),this.isPolygonEditorMod=!0,this.addMidpointsTo(Array.from(this.linesList.keys())),this.backupLinesList=new Map(this.linesList),this.backupPointsList=Object(k["cloneDeep"])(this.pointsList),this.backupThresholdsList=Object(k["cloneDeep"])(this.thresholdsList),this.backupThresholdLinesLayer=Object(k["cloneDeep"])(this.thresholdLinesLayer),this.backupEditableLayers=g.a.featureGroup(this.editableLayers.getLayers(),this.editableLayers.options),this.backupDeletedElements=Object(k["cloneDeep"])(this.deletedElements);for(var e,t,i=this.editableLayers.getLayers(),o=0;o<i.length;o++){var a=i[o]._leaflet_id,s=this;i[o].editing._moveMarker._icon.onmousedown=function(i){e=i.pageX,t=i.pageY},i[o].editing._moveMarker._icon.onmouseup=function(i){i.pageX===e&&i.pageY===t&&s.mergeLinesTo(i.target.tempId)},i[o].editing._moveMarker._icon.tempId=a}},cancelModPolygon:function(){if(this.polygonEditorMod.revertLayers(),this.polygonEditorMod.disable(),this.isPolygonEditorMod=!1,this.midpointsLayer.clearLayers(),this.backupEditableLayers){this.editableLayers.clearLayers();var e=this;this.backupEditableLayers.eachLayer((function(t){e.editableLayers.addLayer(t)}))}this.backupEditableLayers=null,this.backupLinesList&&(this.linesLayers.clearLayers(),this.linesList=this.backupLinesList,this.pointsList=Object(k["cloneDeep"])(this.backupPointsList),this.backupLinesList=new Map,this.backupPointsList=new Map,this.drawLines(this.linesList),this.thresholdsList=Object(k["cloneDeep"])(this.backupThresholdsList),this.map.removeLayer(this.thresholdLinesLayer),this.thresholdLinesLayer=Object(k["cloneDeep"])(this.backupThresholdLinesLayer),this.map.addLayer(this.thresholdLinesLayer),this.thresholdLinesLayer.bringToBack(),this.backupThresholdsList=null,this.backupThresholdLinesLayer=null,this.deletedElements=Object(k["cloneDeep"])(this.backupDeletedElements),this.backupDeletedElements=null)},confirmModPolygon:function(){this.polygonEditorMod.save(),this.polygonEditorMod.disable(),this.isPolygonEditorMod=!1,this.midpointsLayer.clearLayers(),this.backupEditableLayers=null,this.backupLinesList=null,this.backupPointsList=null,this.backupDeletedElements=null,this.storeRoutes()},deletePolygon:function(){this.isPolylineEditorAdd?this.cancelAddPolyline():this.isMarkerEditorAdd?this.cancelAddMarker():this.isPolygonEditorAdd?this.confirmAddPolygon():this.isPolylineEditorCrossroad?this.cancelAddCrossroad():this.isPolylineEditorThreshold?this.cancelAddThreshold():this.isPolygonEditorMod&&this.confirmModPolygon(),this.polygonEditorDel.enable(),this.isPolygonEditorDel=!0,this.isEltDeleted=!1,this.backupLinesList=new Map(this.linesList),this.backupPointsList=Object(k["cloneDeep"])(this.pointsList),this.backupThresholdsList=Object(k["cloneDeep"])(this.thresholdsList),this.backupThresholdLinesLayer=Object(k["cloneDeep"])(this.thresholdLinesLayer),this.backupDeletedElements=Object(k["cloneDeep"])(this.deletedElements),this.unselectVertex()},cancelDelPolygon:function(){this.isPolygonEditorDel&&(this.polygonEditorDel.revertLayers(),this.polygonEditorDel.disable(),this.isPolygonEditorDel=!1,this.linesList=this.backupLinesList,this.pointsList=Object(k["cloneDeep"])(this.backupPointsList),this.thresholdsList=Object(k["cloneDeep"])(this.backupThresholdsList),this.map.removeLayer(this.thresholdLinesLayer),this.thresholdLinesLayer=Object(k["cloneDeep"])(this.backupThresholdLinesLayer),this.map.addLayer(this.thresholdLinesLayer),this.thresholdLinesLayer.bringToBack(),this.backupLinesList=null,this.backupPointsList=null,this.backupThresholdsList=null,this.backupThresholdLinesLayer=null,this.linesLayers.clearLayers(),this.drawLines(this.linesList),this.deletedElements=Object(k["cloneDeep"])(this.backupDeletedElements),this.backupDeletedElements=null)},confirmDelPolygon:function(){this.polygonEditorDel.save(),this.polygonEditorDel.disable(),this.isPolygonEditorDel=!1,this.backupLinesList=null,this.backupPointsList=null,this.backupDeletedElements=null},drawLineToLastVertex:function(e){this.lastPolylineVertexId?this.drawLineBetween(this.lastPolylineVertexId,e):this.pointsList.has(e)||this.pointsList.set(e,{routes:[],thresholds:[]}),this.selectVertex(e)},drawLines:function(e){var t=this;e.forEach((function(e,i){var o=t.editableLayers._layers[e.point1]._latlng,a=t.editableLayers._layers[e.point2]._latlng,s=[o,a],n=g.a.polyline(s,{color:"#4C99D4",id:i,direction:e.direction,point1:e.point1,point2:e.point2});if(t.linesLayers.addLayer(n),e.arrows&&e.arrows.length)for(var r=0;r<e.arrows.length;r++)t.dirArrowsLayer.removeLayer(e.arrows[r]);if(e.direction<2){var l=t.drawArrows([Q(o),Q(a)],2,t.map,e.direction);t.linesList.get(i).arrows=l}var d=Object(m["point"])(Q(o)),c=Object(m["point"])(Q(a)),h=1e3*E()(d,c);t.linesList.get(i).distance=h})),this.linesLayers.bringToBack(),this.storeRoutes()},onPointRightClick:function(e){e.layer._latlng&&(null===this.lastPolylineVertexId?this.selectVertex(e.layer._leaflet_id):(document.getElementById("contextMenu").style.left=e.containerPoint.x+"px",document.getElementById("contextMenu").style.top=e.containerPoint.y+"px",e.layer._leaflet_id===this.lastPolylineVertexId?(this.isSelectAvailable=!1,this.isUnselectAvailable=!0):(this.isSelectAvailable=!0,this.isUnselectAvailable=!1,this.rightClickedVertex=e.layer._leaflet_id),this.isContextMenu=!0))},selectVertex:function(e){this.unselectVertex(),this.lastPolylineVertexId=e,this.editableLayers._layers[e].setStyle({weight:3,radius:10})},unselectVertex:function(){null!==this.lastPolylineVertexId&&this.editableLayers._layers[this.lastPolylineVertexId].setStyle(this.drawPluginOptions.draw.circlemarker),this.lastPolylineVertexId=null},unselectLine:function(){this.selectedLineLayer.clearLayers(),this.isRouteSelected=!1},onPointClick:function(e){this.isPolygonEditorDel&&this.deleteLinesTo(e.sourceTarget._leaflet_id)},onLineClick:function(e){if(this.unselectLine(),this.isPolygonEditorDel){var t=e.sourceTarget.options.id;this.deleteRoute(t)}else if(this.isPolylineEditorThreshold&&this.selectedElementCenter){var i=this.addPointToOn(e.layer.options.id,e.latlng);this.drawThresholdLineTo(i)}else if(!this.isPolylineEditorThreshold){this.selectedLine=e.sourceTarget;var o=g.a.polyline(e.layer._latlngs,{color:"#61C1D2",id:e.sourceTarget.options.id,direction:e.sourceTarget.options.direction,point1:e.sourceTarget.options.point1,point2:e.sourceTarget.options.point2});this.store.commit("setSelectedRouteDirection",e.sourceTarget.options.direction),this.selectedLineLayer.addLayer(o),this.isRouteSelected=!0}},onClickThreshold:function(e){if(this.isPolygonEditorDel){var t=e.sourceTarget._leaflet_id;this.deleteThreshold(t)}},addPointToOn:function(e,t){var i=this.linesList.get(e),o=i.point1,a=V(this.editableLayers._layers[o]._latlng),s=i.point2,n=V(this.editableLayers._layers[s]._latlng),r=Object(m["point"])(V(t)),l=Object(m["lineString"])([a,n]),d=D()(l,r),c=F(d.geometry.coordinates),h=g.a.circleMarker(c,this.drawPluginOptions.draw.circlemarker);h.on("contextmenu",this.onPointRightClick),h.on("click",this.onPointClick),this.editableLayers.addLayer(h);var p=h._leaflet_id;return this.deleteRoute(e),this.drawLineBetween(o,p),this.drawLineBetween(p,s),p},deleteLinesTo:function(e){var t=this.editableLayers.getLayer(e).options.defId;t&&this.deletedElements.points.push({id:t});for(var i=this.pointsList.get(e),o=i.routes,a=i.thresholds,s=0;s<o.length;s++)this.deleteRoute(o[s]);for(var n=0;n<a.length;n++)this.deleteThreshold(a[n]);this.pointsList.delete(e)},deleteThreshold:function(e){var t=this.thresholdsList.get(e),i=this.editableLayers.getLayer(t.pointId).options.defId;i&&this.deletedElements.landings.push({pointId:i,eltId:t.elementId}),this.pointsList.get(t.pointId).thresholds=this.pointsList.get(t.pointId).thresholds.filter((function(t,i,o){return t!==e})),this.thresholdsList.delete(e),this.thresholdLinesLayer.removeLayer(e)},deleteRoute:function(e){var t=this.linesList.get(e),i=this.editableLayers.getLayer(t.point1).options.defId,o=this.editableLayers.getLayer(t.point2).options.defId;if(i&&o&&this.deletedElements.routes.push({point1Id:i,point2Id:o}),this.pointsList.get(t.point1).routes=this.pointsList.get(t.point1).routes.filter((function(t,i,o){return t!==e})),this.pointsList.get(t.point2).routes=this.pointsList.get(t.point2).routes.filter((function(t,i,o){return t!==e})),t.arrows&&t.arrows.length)for(var a=0;a<t.arrows.length;a++)this.dirArrowsLayer.removeLayer(t.arrows[a]);this.linesList.delete(e);for(var s=this.linesLayers.getLayers(),n=0;n<s.length;n++){var r=s[n];e===r.options.id&&this.linesLayers.removeLayer(r._leaflet_id)}},mergeLinesTo:function(e){var t=this.pointsList.get(e).routes;if(2===t.length){var i=this.linesList.get(t[0]),o=this.linesList.get(t[1]),a=i.point1!==e?i.point1:i.point2,s=o.point1!==e?o.point1:o.point2,n=this.drawLineBetween(a,s);this.addMidpointsTo([n]);for(var r=this.midpointsLayer.getLayers(),l=0;l<r.length;l++){var d=r[l];t.includes(d.options.id)&&this.midpointsLayer.removeLayer(d)}this.deleteLinesTo(e),this.editableLayers.removeLayer(e)}},rightClickSelectVertex:function(){this.selectVertex(this.rightClickedVertex),this.isContextMenu=!1},rightClickUnselectVertex:function(){this.unselectVertex(),this.isContextMenu=!1},rightClickCreateLine:function(){for(var e=this.pointsList.get(this.lastPolylineVertexId).routes,t=!0,i=0;i<e.length;i++)if(this.linesList.get(e[i]).point1===this.rightClickedVertex||this.linesList.get(e[i]).point2===this.rightClickedVertex){this.isContextMenu=!1,t=!1;break}t&&(this.drawLineToLastVertex(this.rightClickedVertex),this.isContextMenu=!1)},draftLineToMouse:function(e){var t,i=e.latlng;this.isPolylineEditorAdd&&this.lastPolylineVertexId?t=this.editableLayers._layers[this.lastPolylineVertexId]._latlng:this.selectedElementCenter&&(t=this.centerOfMassLayer._layers[this.selectedElementCenter]._latlng);var o=[i,t],a=g.a.polyline(o,{color:"#4C99D4",opacity:.8,dashArray:"10",interactive:!1});this.draftLayer.clearLayers(),this.draftLayer.addLayer(a)},addMidpoints:function(){var e=this;this.linesList.forEach((function(t,i){var o=e.editableLayers._layers[t.point1]._latlng,a=e.editableLayers._layers[t.point2]._latlng,s=e.myMidPoint(Q(o),Q(a),.5,e.map),n=g.a.circleMarker(s,{fillColor:"#4C99D4",radius:5,stroke:!1,opacity:1,fillOpacity:1,id:i,point1:t.point1,point2:t.point2});e.midpointsLayer.addLayer(n)}))},addMidpointsTo:function(e){for(var t=0;t<e.length;t++){var i=e[t],o=this.linesList.get(i),a=this.editableLayers._layers[o.point1]._latlng,s=this.editableLayers._layers[o.point2]._latlng,n=this.myMidPoint(Q(a),Q(s),.5,this.map),r=g.a.circleMarker(n,{fillColor:"#4C99D4",radius:5,stroke:!1,opacity:1,fillOpacity:1,id:i,point1:o.point1,point2:o.point2});this.midpointsLayer.addLayer(r)}},onHoverMidpoint:function(e){e.sourceTarget.setRadius(10),this.polygonEditorMod._tooltip.updateContent({text:g.a.drawLocal.edit.handlers.edit.tooltip.text,subtext:"Cliquer pour créer un point sur ce chemin."})},onHoverEndMidpoint:function(e){e.sourceTarget.setRadius(5),this.polygonEditorMod._tooltip.updateContent({text:g.a.drawLocal.edit.handlers.edit.tooltip.text,subtext:g.a.drawLocal.edit.handlers.edit.tooltip.subtext})},onHoverCrossroad:function(e){e.sourceTarget.setRadius(10)},onHoverEndCrossroad:function(e){e.sourceTarget.setRadius(5)},onClickMidpoint:function(e){var t=e.sourceTarget.options.id;this.deleteRoute(t);var i=e.sourceTarget.options.point1,o=e.sourceTarget.options.point2,a=g.a.circleMarker(e.sourceTarget._latlng,this.drawPluginOptions.draw.circlemarker);a.on("contextmenu",this.onPointRightClick),a.on("click",this.onPointClick),this.editableLayers.addLayer(a);var s=a._leaflet_id,n=[],r=this.drawLineBetween(i,s),l=this.drawLineBetween(s,o);n.push(r),n.push(l),this.addMidpointsTo(n),this.midpointsLayer.removeLayer(e.sourceTarget._leaflet_id),this.unselectLine(),this.polygonEditorMod._tooltip.updateContent({text:g.a.drawLocal.edit.handlers.edit.tooltip.text,subtext:g.a.drawLocal.edit.handlers.edit.tooltip.subtext});var d,c,h=this.editableLayers._layers[s],p=this;h.editing._moveMarker._icon.onmousedown=function(e){d=e.pageX,c=e.pageY},h.editing._moveMarker._icon.onmouseup=function(e){e.pageX===d&&e.pageY===c&&p.mergeLinesTo(e.target.tempId)},h.editing._moveMarker._icon.tempId=s},onClickCrossroad:function(e){this.deleteRoute(e.layer.options.line1),this.deleteRoute(e.layer.options.line2);var t=g.a.circleMarker(e.sourceTarget._latlng,this.drawPluginOptions.draw.circlemarker);t.on("contextmenu",this.onPointRightClick),t.on("click",this.onPointClick),this.editableLayers.addLayer(t);var i=t._leaflet_id;this.drawLineBetween(e.layer.options.point1,i),this.drawLineBetween(i,e.layer.options.point2),this.drawLineBetween(e.layer.options.point3,i),this.drawLineBetween(i,e.layer.options.point4),this.crossroadLayer.removeLayer(e.layer)},drawLineBetween:function(e,t,i){this.linesLastId++,this.linesList.set(this.linesLastId,{point1:e,point2:t,direction:void 0!==i?i:this.selectedRouteDirection}),this.pointsList.has(e)?this.pointsList.get(e).routes.push(this.linesLastId):this.pointsList.set(e,{routes:[this.linesLastId],thresholds:[]}),this.pointsList.has(t)?this.pointsList.get(t).routes.push(this.linesLastId):this.pointsList.set(t,{routes:[this.linesLastId],thresholds:[]});var o=new Map;return o.set(this.linesLastId,{point1:e,point2:t,direction:void 0!==i?i:this.selectedRouteDirection}),this.drawLines(o),this.linesLastId},storeRoutes:function(){this.store.commit("setRoutesList",this.linesList),this.store.commit("setEditableLayers",this.editableLayers.getLayers()),this.store.commit("setThresholdsList",this.thresholdsList)},editPoint:function(e){for(var t=this.pointsList.get(e),i=t.routes,o=new Map,a=this.linesLayers.getLayers(),s=0;s<a.length;s++){var n=a[s];i.includes(n.options.id)&&(this.linesLayers.removeLayer(n._leaflet_id),o.set(n.options.id,this.linesList.get(n.options.id)))}this.drawLines(o);for(var r,l=t.thresholds,d=0;d<l.length;d++)r=this.thresholdLinesLayer._layers[l[d]],r.setLatLngs([r._latlngs[0],this.editableLayers._layers[e]._latlng]);for(var c=this.midpointsLayer.getLayers(),h=0;h<c.length;h++){var p=c[h];i.includes(p.options.id)&&this.midpointsLayer.removeLayer(p._leaflet_id)}this.addMidpointsTo(i)},addCrossroad:function(){this.isPolylineEditorAdd?this.cancelAddPolyline():this.isMarkerEditorAdd?this.cancelAddMarker():this.isPolygonEditorAdd?this.confirmAddPolygon():this.isPolylineEditorThreshold?this.cancelAddThreshold():this.isPolygonEditorMod?this.confirmModPolygon():this.isPolygonEditorDel&&this.confirmDelPolygon(),this.isPolylineEditorCrossroad=!0;for(var e=H(this.linesLayers.getLayers()),t=0;t<e.length;t++){var i=e[t],o=f()(i[0].toGeoJSON(16),i[1].toGeoJSON(16)),a=i[0].getLatLngs();if(o&&o.features.length){var s=o.features[0].geometry.coordinates;if(!X(V(a[0]),s)&&!X(V(a[1]),s)){var n=g.a.circleMarker([s[1],s[0]],{fillColor:"#4C99D4",radius:5,stroke:!1,opacity:1,fillOpacity:1,line1:i[0].options.id,line2:i[1].options.id,point1:i[0].options.point1,point2:i[0].options.point2,point3:i[1].options.point1,point4:i[1].options.point2});this.crossroadLayer.addLayer(n)}}}},cancelAddCrossroad:function(){this.isPolylineEditorCrossroad=!1,this.crossroadLayer.clearLayers()},addThreshold:function(){this.unselectLine(),this.unselectVertex(),this.isPolylineEditorAdd?this.cancelAddPolyline():this.isMarkerEditorAdd?this.cancelAddMarker():this.isPolygonEditorAdd?this.confirmAddPolygon():this.isPolylineEditorCrossroad?this.cancelAddCrossroad():this.isPolygonEditorMod?this.confirmModPolygon():this.isPolygonEditorDel&&this.confirmDelPolygon(),this.isPolylineEditorThreshold=!0},cancelAddThreshold:function(){this.isPolylineEditorThreshold=!1,this.draftLayer.clearLayers()},onClickEditableLayer:function(e){this.isPolylineEditorThreshold&&(e.layer._latlngs?this.drawCenterOfMassOf(e.layer):this.selectedElementCenter&&this.drawThresholdLineTo(e.layer._leaflet_id))},drawCenterOfMassOf:function(e){var t=U(e._latlngs[0]);t.push(t[0]);var i=S()(Object(m["polygon"])([t])),o=F(i.geometry.coordinates),a=g.a.circleMarker(o,{fillColor:this.drawPluginOptions.draw.polygon.shapeOptions.color,radius:5,stroke:!1,opacity:1,fillOpacity:1,elementTempId:e._leaflet_id,elementId:e.options.elementId});return this.centerOfMassLayer.addLayer(a),this.selectedElementCenter=a._leaflet_id,a._leaflet_id},drawThresholdLineTo:function(e){this.drawThresholdLineBetween(e,this.selectedElementCenter)},drawThresholdLineBetween:function(e,t){for(var i=this.centerOfMassLayer.getLayer(t).options.elementId,o=this.centerOfMassLayer.getLayer(t).options.elementTempId,a=this.pointsList.get(e).thresholds,s=0;s<a.length;s++){var n=this.thresholdsList.get(a[s]);if(n.elementId===i)return this.draftLayer.clearLayers(),void(this.selectedElementCenter=null)}var r=this.centerOfMassLayer._layers[t]._latlng,l=this.editableLayers._layers[e]._latlng,d=[r,l],c=g.a.polyline(d,{color:"#FFCE78"});this.thresholdLinesLayer.addLayer(c),this.draftLayer.clearLayers(),this.thresholdLinesLayer.bringToBack(),this.thresholdsList.set(c._leaflet_id,{elementId:i,elementTempId:o,elementCenterId:t,pointId:e}),this.pointsList.get(e).thresholds.push(c._leaflet_id),this.selectedElementCenter=null},addOverlays:function(){this.layerControl=this.$refs.control.mapObject;var e=g.a.tileLayer("https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/png&LAYER=GEOGRAPHICALGRIDSYSTEMS.MAPS.BDUNI.J1&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",{attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',subdomains:"abcd",minZoom:0,maxZoom:22,maxNativeZoom:18});this.layerControl.addOverlay(e,"GeoportailFrance.PlanIGN.Uni"),this.map.addLayer(e);var t=g.a.tileLayer("https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=bdparcellaire_b&TILEMATRIXSET=PM&FORMAT=image/png&LAYER=CADASTRALPARCELS.PARCELS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",{attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',subdomains:"abcd",minZoom:0,maxZoom:22,maxNativeZoom:20});this.layerControl.addOverlay(t,"GeoportailFrance.Parcels.White");var i=g.a.tileLayer("https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=bdparcellaire_o&TILEMATRIXSET=PM&FORMAT=image/png&LAYER=CADASTRALPARCELS.PARCELS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",{attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',subdomains:"abcd",minZoom:0,maxZoom:22,maxNativeZoom:20});this.layerControl.addOverlay(i,"GeoportailFrance.Parcels.Orange");var o=g.a.tileLayer("https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/png&LAYER=ADMINEXPRESS_COG_CARTO_2018&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",{attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',subdomains:"abcd",minZoom:0,maxZoom:22,maxNativeZoom:16});this.layerControl.addOverlay(o,"GeoportailFrance.COG.Carto");var a=g.a.tileLayer("https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/png&LAYER=ADMINEXPRESS_COG_2018&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",{attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',subdomains:"abcd",minZoom:0,maxZoom:22,maxNativeZoom:16});this.layerControl.addOverlay(a,"GeoportailFrance.COG");var s=g.a.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lines/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:22,maxNativeZoom:20,ext:"png"});this.layerControl.addOverlay(s,"Stamen.TonerLines");var n=g.a.tileLayer("https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}{r}.{ext}",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abcd",minZoom:0,maxZoom:22,maxNativeZoom:20,ext:"png"});this.layerControl.addOverlay(n,"Stamen.TonerLabels")},displayImages:function(){var e=this,t="https://privamap-dev.azurewebsites.net/api/imageLayer/all",i={method:"GET",redirect:"follow"};fetch(t,i).then((function(e){return e.text()})).then((function(t){e.imageList=JSON.parse(t).ImageLayers;for(var i=0;i<e.imageList.length;i++){var o=[parseFloat(e.imageList[i].topLeftLat),parseFloat(e.imageList[i].topLeftLng)],a=[parseFloat(e.imageList[i].topRightLat),parseFloat(e.imageList[i].topRightLng)],s=[parseFloat(e.imageList[i].bottomLeftLat),parseFloat(e.imageList[i].bottomLeftLng)],n="data:"+e.imageList[i].fileType+";base64,"+e.imageList[i].image,r=g.a.imageOverlay.rotated(n,o,a,s,{opacity:.9,interactive:!0});r.addTo(e.map),e.imageLayers.push({id:e.imageList[i].id,layer:r})}})).catch((function(e){return console.log("error",e)}))},displayElements:function(){var e=this,t="https://privamap-dev.azurewebsites.net/api/elementType/all",i={method:"GET",redirect:"follow"};fetch(t,i).then((function(e){return e.text()})).then((function(t){t=JSON.parse(t).ElementTypes;for(var i=null,o=0;o<t.length;o++){i={label:t[o].name,value:t[o]},e.elementTypes.push(i);var a="https://privamap-dev.azurewebsites.net/api/elementType/"+t[o].id+"/elements",s={method:"GET",redirect:"follow"};fetch(a,s).then((function(e){return e.text()})).then((function(t){t=JSON.parse(t);for(var i=t.Elements,o=0;o<i.length;o++)for(var a=0;a<i[o].Shapes.length;a++){var s=q(i[o].Shapes[a].json.coordinates[0]),n=g.a.polygon(s,{color:e.drawPluginOptions.draw.polygon.shapeOptions.color,sahpeId:i[o].Shapes[a].id,elementId:i[o].id,name:i[o].name,shortname:i[o].shortname,description:i[o].description,typeId:t.ElementTypeStyle.id});e.editableLayers.addLayer(n),e.eltsIdDictByDef.set(i[o].id,n._leaflet_id)}})).catch((function(e){return console.log("error",e)}))}})).catch((function(e){return console.log("error",e)}))},displayRoutes:function(){var e=this,t="https://privamap-dev.azurewebsites.net/api/route/all",i={method:"GET",redirect:"follow"};fetch(t,i).then((function(e){return e.text()})).then((function(t){t=JSON.parse(t);for(var i=t.Routes,o=t.Waypoints,a=t.Landings,s=new Map,n=0;n<o.length;n++){var r=o[n],l=g.a.circleMarker([r.latitude,r.longitude],e.drawPluginOptions.draw.circlemarker);l.on("click",e.onPointClick),l.options.defId=r.id,e.editableLayers.addLayer(l),s.set(r.id,l._leaflet_id)}for(var d=0;d<i.length;d++){var c=i[d];e.drawLineBetween(s.get(c.waypoint_1),s.get(c.waypoint_2),c.direction)}var h=e;setTimeout((function(){for(var e=0;e<a.length;e++){var t=a[e],i=h.eltsIdDictByDef.get(t.idElement),o=h.editableLayers.getLayer(i),n=h.drawCenterOfMassOf(o);h.drawThresholdLineBetween(s.get(t.idPoint),n)}}),500)})).catch((function(e){return console.log("error",e)}))},drawArrows:function(e,t,i,o){var a=[];if(null==e||!e.length)return[];"undefined"!==typeof t&&null!=t||(t=1);for(var s=1;s<e.length;s++)for(var n=g.a.icon({iconUrl:0===o?Z.a:B.a,iconSize:[12,20],iconAnchor:[6,10]}),r=1;r<=t;r++){var l=g.a.marker(this.myMidPoint(e[s],e[s-1],r/(t+1),i),{icon:n,rotationAngle:this.getAngle(e[s-1],e[s],-1).toString(),rotationOrigin:"6px 10px"});this.dirArrowsLayer.addLayer(l),a.push(l._leaflet_id)}return a},getAngle:function(e,t,i){var o=t[0]-e[0],a=Math.cos(Math.PI/180*e[0])*(t[1]-e[1]),s=Math.atan2(o,a)/Math.PI*180*i;return s.toFixed(2)},myMidPoint:function(e,t,i,o){if(!o)throw new Error("map is not defined");var a,s,n,r,l=[];if(n=o.project(g.a.latLng(e)),r=o.project(g.a.latLng(t)),a=J(n,r)*i,0===a)return o.unproject(n);if(s=J(n,r),s>a){l=(s-a)/s;var d=o.unproject(new K(r.x-l*(r.x-n.x),r.y-l*(r.y-n.y)));return[d.lat,d.lng]}}}};function Q(e){return[e.lat,e.lng]}function V(e){return[e.lng,e.lat]}function F(e){return g.a.latLng(e[1],e[0])}function q(e){for(var t=[],i=0;i<e.length;i++)t.push([e[i][1],e[i][0]]);return t}function U(e){for(var t=[],i=0;i<e.length;i++)t.push([e[i].lng,e[i].lat]);return t}function J(e,t){var i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)}function H(e){return e.map((function(t,i){return e.slice(i+1).map((function(e){return[t,e]}))})).flat()}function X(e,t){return e.length===t.length&&e.every((function(e,i){return e===t[i]}))}function K(e,t,i){this.x=i?Math.round(e):e,this.y=i?Math.round(t):t}var $=W,ee=i("2877"),te=i("eebe"),ie=i.n(te),oe=i("9989"),ae=i("f09f"),se=i("74f7"),ne=i("cf57"),re=i("1c1c"),le=i("66e5"),de=i("4074"),ce=i("c294"),he=i("72db"),pe=i("9c40"),ge=i("e7a9"),me=i("0016"),ue=i("c1d0"),ye=Object(ee["a"])($,s,n,!1,null,null,null),Le=ye.exports;ie()(ye,"components",{QPage:oe["a"],QCard:ae["a"],QInnerLoading:se["a"],QSpinnerGears:ne["a"],QList:re["a"],QItem:le["a"],QItemSection:de["a"],QFab:ce["a"],QFabAction:he["a"],QBtn:pe["a"],QBtnGroup:ge["a"],QIcon:me["a"],QSlider:ue["a"]});var fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"information-zone"},[i("q-card",{staticClass:"information-card",attrs:{dark:""}},[i("q-item-label",{staticClass:"text-white buttonColor-left list-header",attrs:{header:""}},[e._v("Informations")]),i("q-card-section",[i("div",{staticClass:"row select-type-container"},[i("q-select",{staticClass:"select-type col-10",attrs:{"use-input":"",filled:"","hide-selected":"","fill-input":"",color:"white",dense:"","options-dense":"",options:e.selectOptions,label:"Type"},on:{filter:e.selectFilter},scopedSlots:e._u([{key:"no-option",fn:function(){return[i("q-item",[i("q-item-section",{staticClass:"text-italic text-grey"},[e._v("\n                Aucun résultat\n              ")])],1)]},proxy:!0}]),model:{value:e.selectedElementType,callback:function(t){e.selectedElementType=t},expression:"selectedElementType"}}),i("q-btn",{staticClass:"col-2 add-type-btn",attrs:{flat:"",padding:"xs",color:"white",icon:"fas fa-plus"},on:{click:e.addType}}),i("add-type-dialog",{attrs:{dialogDisplayed:e.dialogDisplayed}})],1)])],1)],1)},Ie=[],be=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-dialog",{attrs:{persistent:""},model:{value:e.isDialog,callback:function(t){e.isDialog=t},expression:"isDialog"}},[i("q-card",{staticClass:"add-type-dialog"},[i("q-toolbar",[i("q-avatar",[i("q-icon",{attrs:{color:"primary",name:"fas fa-pen"}})],1),i("q-toolbar-title",{staticClass:"dialog-title"},[e._v("Nouveau type")]),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",color:"primary",round:"",dense:"",icon:"close"}})],1),i("q-card-section",[i("q-form",{staticClass:"row",on:{submit:e.onSubmit,reset:e.onReset}},[i("div",{staticClass:"q-gutter-y-md col-6 q-pr-sm "},[i("q-input",{staticClass:"dialog-element",attrs:{dense:"",standout:"",label:"Nom",color:"white"},model:{value:e.typeName,callback:function(t){e.typeName=t},expression:"typeName"}}),i("q-input",{staticClass:"dialog-element",attrs:{dense:"",standout:"",label:"Description",color:"white"},model:{value:e.typeDesc,callback:function(t){e.typeDesc=t},expression:"typeDesc"}}),i("q-input",{staticClass:"dialog-element",attrs:{dense:"",standout:"",label:"Couleur",rules:["anyColor"]},on:{blur:e.setColor},scopedSlots:e._u([{key:"prepend",fn:function(){return[i("span",{attrs:{id:"color-square"}},[i("i",{staticClass:"fas fa-square"})])]},proxy:!0},{key:"append",fn:function(){return[i("q-icon",{staticClass:"cursor-pointer",attrs:{name:"colorize"}},[i("q-popup-proxy",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[i("q-color",{model:{value:e.typeColor,callback:function(t){e.typeColor=t},expression:"typeColor"}})],1)],1)]},proxy:!0}]),model:{value:e.typeColor,callback:function(t){e.typeColor=t},expression:"typeColor"}})],1),i("div",{staticClass:"q-gutter-y-md col-6 q-pl-sm q-mt-auto q-mb-auto"},[i("div",[i("q-space"),i("q-badge",{attrs:{color:"primary"}},[e._v("\n              Épaisseur: "+e._s(e.typeSize)+" px\n            ")]),i("q-slider",{attrs:{min:0,max:20,step:1,color:"primary"},model:{value:e.typeSize,callback:function(t){e.typeSize=t},expression:"typeSize"}})],1),i("div",[i("q-badge",{attrs:{color:"primary"}},[e._v("\n              Visible pour les zooms: "+e._s(e.typeZoomRange.min)+" à "+e._s(e.typeZoomRange.max)+"\n            ")]),i("q-range",{attrs:{min:0,max:20,step:1,color:"primary"},model:{value:e.typeZoomRange,callback:function(t){e.typeZoomRange=t},expression:"typeZoomRange"}})],1)]),i("div",{staticClass:"q-ml-auto"},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Annuler",color:"primary"}}),i("q-btn",{attrs:{flat:"",loading:e.progress,type:"submit",color:"primary"},scopedSlots:e._u([{key:"loading",fn:function(){return[i("q-spinner-facebook",{staticClass:"on-center"})]},proxy:!0}])},[e._v("\n            Valider\n            ")])],1)])],1)],1)],1)},Me=[],Ce={name:"AddTypeDialog",props:{dialogDisplayed:{type:Boolean}},data:function(){return{isDialog:!1,fileModel:null,progress:!1,fileText:"",acceptedFormats:".png",placeholder:"File",image:null,typeName:"",typeDesc:"",typeZoomRange:{min:5,max:19},typeColor:"#ffffff",typeSize:3}},watch:{dialogDisplayed:function(e){this.isDialog=!0}},methods:{setColor:function(){console.log("setColor"),console.log(this.typeColor),document.getElementById("color-square").style.color=this.typeColor},onSubmit:function(){var e=this;console.log("confirmForm"),this.isDialog=!1;var t="https://privamap-dev.azurewebsites.net/api/elementType/"+this.typeName+"/"+this.typeDesc,i={method:"POST",redirect:"follow"};fetch(t,i).then((function(e){return e.text()})).then((function(t){console.log("result"),console.log(t);var i=JSON.parse(t).id,o="https://privamap-dev.azurewebsites.net/api/elementTypeStyle/"+i+"/"+e.typeName+"/1/"+e.typeColor.substr(1)+"/"+e.typeZoomRange.min+"/"+e.typeZoomRange.max+"/"+e.typeSize,a={method:"PUT",redirect:"follow"};fetch(o,a).then((function(e){return e.text()})).then((function(e){console.log("result"),console.log(e)})).catch((function(e){return console.log("error",e)}))})).catch((function(e){return console.log("error",e)}))},onReset:function(){}}},we=Ce,Te=i("24e8"),ve=i("65c6"),Ee=i("cb32"),xe=i("6ac5"),Se=i("a370"),Ae=i("0378"),De=i("27f9"),ke=i("7cbe"),Ne=i("b498"),Pe=i("2c91"),Re=i("58a8"),je=i("7bbf"),Oe=i("e669"),ze=i("7f67"),Ge=Object(ee["a"])(we,be,Me,!1,null,null,null),Ze=Ge.exports;ie()(Ge,"components",{QDialog:Te["a"],QCard:ae["a"],QToolbar:ve["a"],QAvatar:Ee["a"],QIcon:me["a"],QToolbarTitle:xe["a"],QBtn:pe["a"],QCardSection:Se["a"],QForm:Ae["a"],QInput:De["a"],QPopupProxy:ke["a"],QColor:Ne["a"],QSpace:Pe["a"],QBadge:Re["a"],QSlider:ue["a"],QRange:je["a"],QSpinnerFacebook:Oe["a"]}),ie()(Ge,"directives",{ClosePopup:ze["a"]});var _e={name:"InformationCard",components:{"add-type-dialog":Ze},data:function(){return{store:N["a"],selectOptions:[],selectedElementType:null,dialogDisplayed:!1}},created:function(){var e=this,t="https://privamap-dev.azurewebsites.net/api/elementType/all",i={method:"GET",redirect:"follow"};this.elementTypes=[],fetch(t,i).then((function(e){return e.text()})).then((function(t){console.log("element Types"),console.log(t),t=JSON.parse(t).ElementTypes;for(var i=null,o=0;o<t.length;o++)i={label:t[o].name,value:t[o]},e.elementTypes.push(i);e.selectOptions=e.elementTypes,e.elementTypes.length>0&&(e.selectedElementType=e.elementTypes[0])})).catch((function(e){return console.log("error",e)}))},computed:{elementTypes:{get:function(){return this.store.state.elementTypes},set:function(e){this.store.commit("setElementTypes",e)}}},watch:{selectedElementType:function(e){this.store.commit("setSelectedElementType",e)}},methods:{selectFilter:function(e,t){var i=this;t((function(){if(""===e)i.selectOptions=i.elementTypes;else{var t=e.toLowerCase();i.selectOptions=i.elementTypes.filter((function(e){return e.label.toLowerCase().indexOf(t)>-1}))}}),(function(t){""!==e&&t.options.length>0&&-1===t.optionIndex&&(t.moveOptionSelection(1,!0),t.toggleOption(t.options[t.optionIndex],!0))}))},addType:function(){console.log("addType"),this.dialogDisplayed=!this.dialogDisplayed}}},Be=_e,Ye=i("0170"),We=i("ddd8"),Qe=Object(ee["a"])(Be,fe,Ie,!1,null,null,null),Ve=Qe.exports;ie()(Qe,"components",{QCard:ae["a"],QItemLabel:Ye["a"],QCardSection:Se["a"],QSelect:We["a"],QItem:le["a"],QItemSection:de["a"],QBtn:pe["a"]});var Fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"information-zone"},[i("q-card",{staticClass:"information-card",attrs:{dark:""}},[i("q-item-label",{staticClass:"text-white buttonColor-left list-header",attrs:{header:""}},[e._v("Informations")]),i("q-card-section",[i("div",[e._v("Sens de circulation")]),i("q-btn-group",{staticClass:"infoPanelBtnGroup"},[i("q-btn",{attrs:{id:"twoWayDirections",color:2==e.selectedRouteDirection?"white":"none","text-color":2==e.selectedRouteDirection?"primary":"white",icon:"fas fa-exchange-alt"},on:{click:function(t){return e.selectDirection(2)}}}),i("q-btn",{attrs:{color:0==e.selectedRouteDirection?"white":"none","text-color":0==e.selectedRouteDirection?"primary":"white",icon:"fas fa-long-arrow-alt-up"},on:{click:function(t){return e.selectDirection(0)}}}),i("q-btn",{attrs:{color:1==e.selectedRouteDirection?"white":"none","text-color":1==e.selectedRouteDirection?"primary":"white",icon:"fas fa-long-arrow-alt-down"},on:{click:function(t){return e.selectDirection(1)}}})],1)],1)],1)],1)},qe=[],Ue={name:"RouteInformationCard",components:{},data:function(){return{store:N["a"],dialogDisplayed:!1}},created:function(){},computed:{selectedRouteDirection:function(){return this.store.state.selectedRouteDirection},routesList:function(){return this.store.state.routesList},editableLayers:function(){return this.store.state.editableLayers},elementTypes:{get:function(){return this.store.state.elementTypes},set:function(e){this.store.commit("setElementTypes",e)}}},methods:{selectDirection:function(e){this.store.commit("setSelectedRouteDirection",e)},saveInformations:function(){console.log("saveInformations"),console.log("this.routesList"),console.log(this.routesList),console.log("this.editableLayers"),console.log(this.editableLayers)}}},Je=Ue,He=Object(ee["a"])(Je,Fe,qe,!1,null,null,null),Xe=He.exports;ie()(He,"components",{QCard:ae["a"],QItemLabel:Ye["a"],QCardSection:Se["a"],QBtnGroup:ge["a"],QBtn:pe["a"]});var Ke={components:{"map-component":Le,"information-card":Ve,"route-information-card":Xe},name:"PageIndex",data:function(){return{store:N["a"]}},computed:{isInfoPanelDisplayed:function(){return N["a"].state.isInfoPanelDisplayed},isRouteLevel:function(){return N["a"].state.isRouteLevel}},watch:{}},$e=Ke,et=Object(ee["a"])($e,o,a,!1,null,null,null);t["default"]=et.exports;ie()(et,"components",{QPage:oe["a"]})},"1d2c":function(e,t,i){},"6af5":function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyNC4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FscXVlXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMjAgMzAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDIwIDMwOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDp1cmwoI1NWR0lEXzFfKTt9DQoJLnN0MXtmaWxsOnVybCgjU1ZHSURfMl8pO30NCgkuc3Qye2ZpbGw6I0E2QjJFNzt9DQo8L3N0eWxlPg0KPGc+DQoJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8xXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMS44MjMyIiB5MT0iMTUuNDcxOCIgeDI9IjExLjgyMzIiIHkyPSI0LjQ1MzMiPg0KCQk8c3RvcCAgb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjojNEM5OUQ0Ii8+DQoJCTxzdG9wICBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiMyRjUyQTAiLz4NCgk8L2xpbmVhckdyYWRpZW50Pg0KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik03Ljc0LDEyLjc4YzAsMCwxLjY0LDAuMzksMy41Mi0xLjU3czEuMzEtNC43MywwLjU0LTYuMDZzMi44OC0wLjQ0LDMuNjIsMS43NWMwLjc0LDIuMTgsMS4xMyw1LjAzLTEsNy4wOQ0KCQlzLTUuMTYsMS43LTYuMTQsMS4wNVM3Ljc0LDEyLjc4LDcuNzQsMTIuNzh6Ii8+DQoJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8yXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI4LjExOSIgeTE9IjIuMDE2IiB4Mj0iOC4xMTkiIHkyPSIyNy4xMzI5Ij4NCgkJPHN0b3AgIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6IzRDOTlENCIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojMkY1MkEwIi8+DQoJPC9saW5lYXJHcmFkaWVudD4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMTEuNDQsMjguODhsLTMuMzctMS43OGMwLDAtNC4zLTEwLjM1LTUuNjUtMTMuMzVzLTEuOS00LjgsMC4wNS04Ljc1czYuNzUtNS4yNSw5LjQ1LTMuOXMzLjEzLDEuNjYsMy4xMywxLjY2DQoJCWwtMS40MSwxLjVsLTUuMywwLjQyTDYuMzksNy4yOEw2LjM0LDExLjJsMS42MSw1LjcyTDExLjQ0LDI4Ljg4eiIvPg0KCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0xNS4wNCwyLjc1QzEyLjQyLDAuODgsNi4xLDIuNzksNC43Niw3LjY5Yy0xLjM0LDQuOS0wLjIyLDYuMDEsMi4wNSwxMS4wNHM0LjYzLDEwLjE1LDQuNjMsMTAuMTUNCgkJczYuNS0xNC4wNyw3LjA4LTE4LjNDMTkuMDksNi4zNSwxNy42Nyw0LjYyLDE1LjA0LDIuNzV6IE0xNS4xMiwxMC45N2MtMC41OSwxLjc5LTIuNyw0LjA5LTUuNDIsMy4yMVM2LjU0LDkuNzQsOC4zOCw3LjE5DQoJCWMxLjA4LTEuNSwzLjE5LTIuMzMsNS4wMy0xLjQyQzE1LjI0LDYuNjgsMTUuNzEsOS4xOCwxNS4xMiwxMC45N3oiLz4NCjwvZz4NCjwvc3ZnPg0K"},b94f:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4wICg0MDM1YTRmYjQ5LCAyMDIwLTA1LTAxKSIKICAgaGVpZ2h0PSI4Ny41Mjc0OTYiCiAgIHdpZHRoPSI1Mi44NDI0OTkiCiAgIHNvZGlwb2RpOmRvY25hbWU9Im5vdW5fcmlnaHQgY2hldnJvbl8zNTI5NDc4LnN2ZyIKICAgaWQ9InN2ZzgiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIHZpZXdCb3g9IjAgMCA1Mi44NDI0OTkgODcuNTI3NDk2IgogICB5PSIwcHgiCiAgIHg9IjBweCIKICAgdmVyc2lvbj0iMS4xIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNCI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEyIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc4IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii05IgogICAgIGlua3NjYXBlOndpbmRvdy14PSItOSIKICAgICBpbmtzY2FwZTpjeT0iNDUuNzA4Nzg4IgogICAgIGlua3NjYXBlOmN4PSIyNi40MiIKICAgICBpbmtzY2FwZTp6b29tPSI3LjA0IgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpZD0ibmFtZWR2aWV3MTAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTA1MSIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE5MjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIgLz48cGF0aAogICAgIHN0eWxlPSJmaWxsOiM0Yzk5ZDQ7ZmlsbC1vcGFjaXR5OjEiCiAgICAgaWQ9InBhdGgyIgogICAgIGQ9Im0gNTIuMjUsNDUuMTc3NSAtNDAuMyw0MC4zIGMgLTEuMzIsMS4zMiAtMy4wOCwyLjA1IC00Ljk1LDIuMDUgLTEuODcsMCAtMy42MywtMC43MyAtNC45NSwtMi4wNSAtMS4zMiwtMS4zMiAtMi4wNSwtMy4wOCAtMi4wNSwtNC45NSAwLC0xLjg3IDAuNzMsLTMuNjMgMi4wNSwtNC45NSBsIDMxLjgyLC0zMS44MSAtMzEuODIsLTMxLjgyIGMgLTIuNzMsLTIuNzMgLTIuNzMsLTcuMTcgMCwtOS45IDIuNzMsLTIuNzMgNy4xNywtMi43MyA5LjksMCBsIDQwLjMsNDAuMzEgYyAwLjc5LDAuNzggMC43OSwyLjA0IDAsMi44MiB6IiAvPjwvc3ZnPgo="},cf23:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyNC4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FscXVlXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMjAgMzAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDIwIDMwOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbDp1cmwoI1NWR0lEXzFfKTt9DQoJLnN0MXtmaWxsOnVybCgjU1ZHSURfMl8pO30NCgkuc3Qye2ZpbGw6IzYxQzFEMjt9DQo8L3N0eWxlPg0KPGc+DQoJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8xXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMS44MjMyIiB5MT0iMTUuNDcxOCIgeDI9IjExLjgyMzIiIHkyPSI0LjQ1MzMiPg0KCQk8c3RvcCAgb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjojNEM5OUQ0Ii8+DQoJCTxzdG9wICBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiMyRjUyQTAiLz4NCgk8L2xpbmVhckdyYWRpZW50Pg0KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik03Ljc0LDEyLjc4YzAsMCwxLjY0LDAuMzksMy41Mi0xLjU3czEuMzEtNC43MywwLjU0LTYuMDZzMi44OC0wLjQ0LDMuNjIsMS43NWMwLjc0LDIuMTgsMS4xMyw1LjAzLTEsNy4wOQ0KCQlzLTUuMTYsMS43LTYuMTQsMS4wNVM3Ljc0LDEyLjc4LDcuNzQsMTIuNzh6Ii8+DQoJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8yXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI4LjExOSIgeTE9IjIuMDE2IiB4Mj0iOC4xMTkiIHkyPSIyNy4xMzI5Ij4NCgkJPHN0b3AgIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6IzRDOTlENCIvPg0KCQk8c3RvcCAgb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojMkY1MkEwIi8+DQoJPC9saW5lYXJHcmFkaWVudD4NCgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMTEuNDQsMjguODhsLTMuMzctMS43OGMwLDAtNC4zLTEwLjM1LTUuNjUtMTMuMzVzLTEuOS00LjgsMC4wNS04Ljc1czYuNzUtNS4yNSw5LjQ1LTMuOXMzLjEzLDEuNjYsMy4xMywxLjY2DQoJCWwtMS40MSwxLjVsLTUuMywwLjQyTDYuMzksNy4yOEw2LjM0LDExLjJsMS42MSw1LjcyTDExLjQ0LDI4Ljg4eiIvPg0KCTxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0xNS4wNCwyLjc1QzEyLjQyLDAuODgsNi4xLDIuNzksNC43Niw3LjY5Yy0xLjM0LDQuOS0wLjIyLDYuMDEsMi4wNSwxMS4wNHM0LjYzLDEwLjE1LDQuNjMsMTAuMTUNCgkJczYuNS0xNC4wNyw3LjA4LTE4LjNDMTkuMDksNi4zNSwxNy42Nyw0LjYyLDE1LjA0LDIuNzV6IE0xNS4xMiwxMC45N2MtMC41OSwxLjc5LTIuNyw0LjA5LTUuNDIsMy4yMVM2LjU0LDkuNzQsOC4zOCw3LjE5DQoJCWMxLjA4LTEuNSwzLjE5LTIuMzMsNS4wMy0xLjQyQzE1LjI0LDYuNjgsMTUuNzEsOS4xOCwxNS4xMiwxMC45N3oiLz4NCjwvZz4NCjwvc3ZnPg0K"},dd31:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4wICg0MDM1YTRmYjQ5LCAyMDIwLTA1LTAxKSIKICAgaGVpZ2h0PSI4Ny41Mjc0OTYiCiAgIHdpZHRoPSI1Mi44NDI0OTkiCiAgIHNvZGlwb2RpOmRvY25hbWU9Im5vdW5fcmlnaHQgY2hldnJvbl8zNTI5NDc4X2ludi5zdmciCiAgIGlkPSJzdmc4IgogICB4bWw6c3BhY2U9InByZXNlcnZlIgogICB2aWV3Qm94PSIwIDAgNTIuODQyNDk5IDg3LjUyNzQ5NiIKICAgeT0iMHB4IgogICB4PSIwcHgiCiAgIHZlcnNpb249IjEuMSI+PG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhMTQiPjxyZGY6UkRGPjxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj48ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD48ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+PGRjOnRpdGxlPjwvZGM6dGl0bGU+PC9jYzpXb3JrPjwvcmRmOlJERj48L21ldGFkYXRhPjxkZWZzCiAgICAgaWQ9ImRlZnMxMiIgLz48c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnOCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIgogICAgIGlua3NjYXBlOndpbmRvdy15PSItOSIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iLTkiCiAgICAgaW5rc2NhcGU6Y3k9IjQ1LjcwODc4OCIKICAgICBpbmtzY2FwZTpjeD0iMjYuNDIiCiAgICAgaW5rc2NhcGU6em9vbT0iNy4wNCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaWQ9Im5hbWVkdmlldzEwIgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEwNTEiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxOTIwIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiIC8+PHBhdGgKICAgICBzdHlsZT0iZmlsbDojNGM5OWQ0O2ZpbGwtb3BhY2l0eToxIgogICAgIGlkPSJwYXRoMiIKICAgICBkPSJtIDAuNTkyNSw0Mi4zNSA0MC4zLC00MC4zIGMgMS4zMiwtMS4zMiAzLjA4LC0yLjA1IDQuOTUsLTIuMDUgMS44NywwIDMuNjMsMC43MyA0Ljk1LDIuMDUgMS4zMiwxLjMyIDIuMDUsMy4wOCAyLjA1LDQuOTUgMCwxLjg3IC0wLjczLDMuNjMgLTIuMDUsNC45NSBsIC0zMS44MiwzMS44MSAzMS44MiwzMS44MiBjIDIuNzMsMi43MyAyLjczLDcuMTcgMCw5LjkgLTIuNzMsMi43MyAtNy4xNywyLjczIC05LjksMCBsIC00MC4zLC00MC4zMSBjIC0wLjc5LC0wLjc4IC0wLjc5LC0yLjA0IDAsLTIuODIgeiIgLz48L3N2Zz4K"},e526:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-dialog",{attrs:{persistent:""},model:{value:e.isDialog,callback:function(t){e.isDialog=t},expression:"isDialog"}},[i("q-card",[i("q-toolbar",[i("q-avatar",[i("q-icon",{attrs:{name:"file_download"}})],1),i("q-toolbar-title",[e._v("Selectionner le fichier à importer")]),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1),i("q-card-section",[i("q-file",{attrs:{color:"primary",filled:"",accept:e.acceptedFormats,label:e.placeholder},on:{rejected:e.onRejected},scopedSlots:e._u([{key:"prepend",fn:function(){return[i("q-icon",{attrs:{name:"insert_drive_file"}})]},proxy:!0}]),model:{value:e.fileModel,callback:function(t){e.fileModel=t},expression:"fileModel"}})],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),i("q-btn",{attrs:{flat:"",loading:e.progress,color:"primary",disabled:!e.fileModel},on:{click:e.importFile},scopedSlots:e._u([{key:"loading",fn:function(){return[i("q-spinner-facebook",{staticClass:"on-center"})]},proxy:!0}])},[e._v("\n        Import\n        ")])],1)],1)],1)},a=[],s=(i("7f7f"),i("28a5"),i("e94f")),n={name:"ImportDialog",props:{dialogOptions:{type:Object,importedData:null}},data:function(){return{isDialog:!1,fileModel:null,progress:!1,fileText:"",acceptedFormats:".png",placeholder:"File",image:null}},watch:{dialogOptions:function(e){this.placeholder=e.placeholder,this.acceptedFormats=e.acceptedFormats,this.fileModel=null,this.progress=!1,this.isDialog=!0},fileModel:function(e){console.log("fileModel"),console.log(e)}},methods:{onRejected:function(e){this.$q.notify({type:"negative",message:"Given file is not in a supported format"})},importFile:function(){var e=this;if(this.progress=!0,console.log("this.fileModel"),console.log(this.fileModel),this.fileModel.size>2e7)this.$q.notify({type:"negative",message:"Given file is too large to be imported"}),this.progress=!1;else{var t=this.fileModel.name.split("."),i=t[t.length-1],o=new FileReader;"kml"===i||"json"===i?(o.addEventListener("load",(function(t){if(e.fileText=t.target.result,"kml"===i){var o=(new DOMParser).parseFromString(e.fileText,"text/xml");e.importedData=JSON.stringify(Object(s["kml"])(o))}else e.importedData=e.fileText;e.$emit("importedData",e.importedData),e.progress=!1,e.isDialog=!1})),o.readAsText(this.fileModel)):(this.$emit("importedData",this.fileModel),this.progress=!1,this.isDialog=!1)}}}},r=n,l=i("2877"),d=i("eebe"),c=i.n(d),h=i("24e8"),p=i("f09f"),g=i("65c6"),m=i("cb32"),u=i("0016"),y=i("6ac5"),L=i("9c40"),f=i("a370"),I=i("7d53"),b=i("4b7e"),M=i("e669"),C=i("7f67"),w=Object(l["a"])(r,o,a,!1,null,null,null);t["a"]=w.exports;c()(w,"components",{QDialog:h["a"],QCard:p["a"],QToolbar:g["a"],QAvatar:m["a"],QIcon:u["a"],QToolbarTitle:y["a"],QBtn:L["a"],QCardSection:f["a"],QFile:I["a"],QCardActions:b["a"],QSpinnerFacebook:M["a"]}),c()(w,"directives",{ClosePopup:C["a"]})},f33e:function(e,t,i){}}]);