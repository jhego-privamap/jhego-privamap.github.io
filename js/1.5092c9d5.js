(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{"07a4":function(e,t,i){"use strict";i("ac6a"),i("cadf"),i("06db"),i("5df3"),i("f400");var n=i("2b0e"),o=i("2f62");n["default"].use(o["a"]),t["a"]=new o["a"].Store({state:{selectedTreeElement:null,isRetryLocate:!1,geolocDisabled:!1,isDirectionMode:!1,itineraryStartTreeElt:"-1",isNavigationMode:!1,selectDepartureOnMap:0,selectArrivalOnMap:0,isNoDirectionOnChange:!1,isTreeSelectOpen:!1,isNavigationImage:!1,remainingDistance:0,isShowQrCode:!1,qrCodeURL:"",isInterior:!1,interiorId:null,isPreview:!1,styleByTypeId:{},eltsPropsById:new Map},mutations:{setSelectedTreeElement:function(e,t){e.selectedTreeElement=t},setRetryLocate:function(e,t){e.isRetryLocate=t},setGeolocDisabled:function(e,t){e.geolocDisabled=t},setDirectionMode:function(e,t){e.isDirectionMode=t},setItineraryStartTreeElt:function(e,t){e.itineraryStartTreeElt=t},setNavigationMode:function(e,t){e.isNavigationMode=t},setSelectDepartureOnMap:function(e,t){e.selectDepartureOnMap=t},setSelectArrivalOnMap:function(e,t){e.selectArrivalOnMap=t},setNoDirectionOnChange:function(e,t){e.isNoDirectionOnChange=t},setTreeSelectOpen:function(e,t){e.isTreeSelectOpen=t},setNavigationImage:function(e,t){e.isNavigationImage=t},setRemainingDistance:function(e,t){e.remainingDistance=t},setShowQrDialog:function(e,t){console.log(t),e.isShowQrCode=t},setQrCodeURL:function(e,t){console.log(t),e.qrCodeURL=t},setInterior:function(e,t){e.isInterior=t},setInteriorId:function(e,t){e.interiorId=t},setPreview:function(e,t){e.isPreview=t},setStyleByTypeId:function(e,t){e.styleByTypeId=t},setEltsPropsById:function(e,t){console.log("setEltsPropsById triggered with"),console.log(t),e.eltsPropsById=t}}})},"0e66":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{staticClass:"noDoubleTap",attrs:{onClick:"{e => e.preventDefault()}"}},[i("meta",{attrs:{name:"viewport",content:"width=device-width, user-scalable=no"}}),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("map-component")],1)])])},o=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{staticClass:"flex mapPage noDoubleTap",attrs:{sync:"",onClick:"{e => e.preventDefault()}"}},[i("geoLocErrorNotif"),i("q-card",{staticStyle:{flex:"1"},attrs:{id:"map"}},[i("div",{attrs:{id:"navImageContainer"}}),i("MglMap",{staticStyle:{height:"calc(var(--vh, 1vh) * 100 - 81px)"},attrs:{id:"mapElement",logoPosition:"bottom-right",accessToken:e.accessToken,mapStyle:e.mapStyle,center:e.center,zoom:e.zoom,maxZoom:e.maxZoom,minZoom:e.minZoom,trackResize:!0,attributionControl:!1,antialias:!0},on:{load:e.load}},[i("MglNavigationControl",{attrs:{color:"mapButton",position:"top-right",showCompass:!0,showZoom:!1}}),i("MglNavigationControl",{attrs:{color:"mapButton",position:"top-right",showCompass:!1}}),i("MglScaleControl",{attrs:{position:"bottom-left"}}),i("MglAttributionControl",{attrs:{position:"bottom-left",customAttribution:"PrivaMap"}}),i("q-page-sticky",{staticClass:"mapButtonsFab mapbox-ctrl"},[e.isInterior&&e.elevatorTotalFloors>1?i("q-slider",{attrs:{min:0,max:e.elevatorTotalFloors-1,step:1,color:"primary",vertical:"",reverse:"",snap:"",markers:""},on:{change:e.onFloorChange},model:{value:e.currentFloor,callback:function(t){e.currentFloor=t},expression:"currentFloor"}}):e._e(),e.isInterior?e._e():i("q-btn",{staticClass:"centerFloatingBtn",attrs:{square:"",size:"17px",padding:"xs",color:"mapButton"},on:{click:function(t){return e.centerMap()}}}),e.isInterior?e._e():i("q-btn",{attrs:{square:"",size:"17px",padding:"xs",icon:"location_on",color:"mapButton"},on:{click:function(t){return e.centerUserLoc()}}})],1),e.isDirections&&e.routePath?i("q-page-sticky",{staticClass:"startDirectionsBtn"},[e.isNavBtnDisplayed?i("q-btn",{attrs:{id:"navigationBtn",square:"",padding:"xs",color:"mapButton",icon:"fas fa-location-arrow",label:e.isFullPageLoading?"Chargement...":"Navigation"},on:{click:function(t){return e.startNavigation()}}}):e._e(),e.isFullPageLoading?e._e():i("q-btn",{attrs:{id:"previewBtn",square:"",padding:"xs",color:"mapButton",icon:"fas fa-route",label:"Aper√ßu"},on:{click:function(t){return e.startPreview()}}})],1):e._e()],1),e.isLoading?i("q-banner",{staticClass:"text-white bg-secondary",attrs:{id:"loadingBanner","inline-actions":""},scopedSlots:e._u([{key:"avatar",fn:function(){return[i("q-spinner-gears",{attrs:{color:"white",size:"5vh"}})]},proxy:!0}],null,!1,144345241)},[e._v("\n      "+e._s(e.loadingText)+"\n      ")]):e._e(),i("q-expansion-item",{staticStyle:{visibility:"hidden"},attrs:{id:"infoBanner","expand-icon":"ion-add","header-class":"bg-primary text-white","expand-icon-toggle":""},on:{"after-show":e.setMapMaxHeight,"before-hide":e.setMapMaxHeight},scopedSlots:e._u([{key:"header",fn:function(){return[i("q-item-section",{staticClass:"col-2",attrs:{id:"infoBannerIcon"}},[e.isDefaultTypeIcon?i("q-icon",{attrs:{name:"assignment",color:"white",size:"1.715em"}}):i("q-icon",{attrs:{color:"white",size:"1.715em"}},[i("svg",{attrs:{id:"infoBannerSVG",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}})])],1),i("q-item-section",{attrs:{id:"infoBannerText"}},[i("div",{staticClass:"row",attrs:{id:"infoBannerName"}},[e._v(e._s(e.infoName))]),i("div",{staticClass:"row",attrs:{id:"infoBannerShortName"}},[e._v(e._s(e.infoShortName))])]),i("q-item-section",{attrs:{side:""}},[i("div",{staticClass:"row items-center infoBannerBtns"},[i("q-btn",{staticClass:"infoBtn",attrs:{unelevated:"",round:"",size:"lg",color:"primary",icon:e.expandedInfo?"fas fa-chevron-down":"info_outline"},on:{click:function(t){return e.toggleInfoDesc()}}}),i("q-btn",{staticClass:"dirBtn",attrs:{unelevated:"",round:"",size:"lg",color:"primary",icon:"fas fa-directions"},on:{click:function(t){return e.startDirection()}}}),i("q-btn",{staticClass:"closeBtn",attrs:{unelevated:"",round:"",size:"lg",color:"primary",icon:"fas fa-times"},on:{click:function(t){return e.onClickCloseInfoBanner()}}})],1)])]},proxy:!0}]),model:{value:e.expandedInfo,callback:function(t){e.expandedInfo=t},expression:"expandedInfo"}},[i("q-card",[i("q-card-section",{staticClass:"q-pa-none",attrs:{id:"infoContent"}},[i("q-btn",{attrs:{id:"shareQrCodeBtn",color:"primary",size:"lg",icon:"mdi-qrcode",label:"Partager"},on:{click:function(t){return e.shareQrCode()}}}),i("q-list",{attrs:{bordered:""}},e._l(e.descGroups,(function(t,n){return i("div",{key:n},[i("q-expansion-item",{ref:"",refInFor:!0,attrs:{group:"infoContentGroup",label:t.title,"header-class":"bg-light-grey text-primary descTitle"},on:{show:function(i){return e.loadDescImages(t.id,n)},"after-show":function(t){e.isInfoOnTransition=!1}},model:{value:t.isExpanded,callback:function(i){e.$set(t,"isExpanded",i)},expression:"descGroup.isExpanded"}},[i("q-card",[t.text?i("q-card-section",[e._v("\n                    "+e._s(t.text)+"\n                  ")]):e._e(),e.descImagesLoaded&&e.displayedImages.length&&!e.isInfoOnTransition?i("q-card-section",{staticClass:"row"},e._l(e.displayedImages,(function(e,t){return i("div",{key:t,staticClass:"rounded-borders descImage q-ma-xs"},[i("q-img",{directives:[{name:"img",rawName:"v-img",value:{src:"data:"+e.fileType+";base64,"+e.image,sourceButton:!1},expression:"{src: 'data:'+ displayedImage.fileType + ';base64,' + displayedImage.image,\n                      sourceButton: false\n                      }"}],attrs:{src:"data:"+e.fileType+";base64,"+e.image,ratio:1,"spinner-color":"primary"}})],1)})),0):t.numberOfPictures?i("q-card-section",{staticClass:"row"},e._l(t.numberOfPictures,(function(e){return i("div",{key:e,staticClass:"rounded-borders descImage q-ma-xs"},[i("q-skeleton",{attrs:{height:"100%",square:""}})],1)})),0):e._e()],1)],1),i("q-separator")],1)})),0),0==e.descGroups.length?i("div",{staticClass:"q-ma-md"},[e._v("\n            Aucune information disponible.\n          ")]):e._e()],1)],1)],1),i("div",{staticClass:"popupBtnContainer xyz-in",attrs:{id:"popupBtnContainer",xyz:"fade small-100% duration-0.8 origin-bottom"}},[i("q-btn",{staticClass:"popupBtn",attrs:{color:"accent",icon:"fas fa-sign-in-alt"},on:{click:e.enterBuilding}})],1),e.isInterior?i("q-page-sticky",{staticClass:"interiorUpperLeftSticky",attrs:{position:"top-left",offset:[15,15]}},[i("q-btn",{staticClass:"exitBtn",attrs:{id:"exitBuildingBtn",round:"",size:"17px",padding:"xs",icon:"fas fa-sign-out-alt",color:"accent"},on:{click:function(t){return e.exitBuilding()}}}),i("div",{staticClass:"toggle-background"},[i("div",{staticClass:"colored-background"},[e.isElementSelected?i("q-toggle",{attrs:{"checked-icon":"fas fa-filter",color:"white","unchecked-icon":"fas fa-filter",label:"Filtrer par type","icon-color":"accent",size:"48px"},model:{value:e.isTypesFiltered,callback:function(t){e.isTypesFiltered=t},expression:"isTypesFiltered"}}):e._e()],1)])],1):e._e(),i("q-inner-loading",{attrs:{showing:e.isFullPageLoading}},[i("q-spinner-gears",{attrs:{size:"20vmin",color:"primary"}})],1),e.isNoInteraction?i("div",{attrs:{id:"interactionBlocker"}}):e._e()],1)],1)},r=[],a=(i("8e6e"),i("456d"),i("ac4d"),i("8a81"),i("1c4c"),i("551c"),i("a34a")),l=i.n(a),c=i("9523"),d=i.n(c),u=(i("96cf"),i("c973")),p=i.n(u),h=(i("7f7f"),i("6762"),i("2fdb"),i("6b54"),i("28a5"),i("ac6a"),i("cadf"),i("06db"),i("5df3"),i("f400"),i("ac6d"),i("2397"),i("970b")),m=i.n(h),g=i("5bc3"),f=i.n(g),y=i("8962"),v=i.n(y),I=i("ed6d"),b=i.n(I),T=i("6b58"),S=i.n(T),E=i("36c6"),L=i.n(E),B=i("e192"),k=i.n(B);function w(e){var t=x();return function(){var i,n=L()(e);if(t){var o=L()(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return S()(this,i)}}function x(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var P=function(e){b()(i,e);var t=w(i);function i(){return m()(this,i),t.apply(this,arguments)}return f()(i,[{key:"remove",value:function(){console.log("privamap popup");var e=document.getElementById("popupBtnContainerOpen");e.classList.remove("xyz-in"),e.classList.add("xyz-out");var t=this;setTimeout((function(){t.superRemove()}),400)}},{key:"superRemove",value:function(){console.log("superRemove"),v()(L()(i.prototype),"remove",this).call(this)}}]),i}(k.a.Popup),M=(i("cb43"),i("bbf4"),i("409f")),C=i.n(M),D=i("7fd5"),N=i("aa1a"),O=i.n(N),F=i("8f76"),G=i.n(F),R=i("aeff"),A=i.n(R),q=i("feb7"),z=i("792c"),j=i.n(z),_=i("7ceb"),Z=i("f3f3"),Q=i.n(Z),H=i("3b74"),U=i.n(H),J=i("5eb8"),V=i.n(J),$=i("4596"),X=i.n($),Y=i("9e5b"),W=i.n(Y),K=i("07a4"),ee=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.geolocationDisabled&&!e.noGeolocBannerReduced?i("q-banner",{staticClass:"text-white bg-red",attrs:{id:"noGeolocationBanner","inline-actions":""}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-8"},[e._v("\n        Votre position n'a pas pu √™tre d√©tect√©e. "+e._s(e.locationErrorText)+"\n      ")]),i("div",{staticClass:"col-4"},[i("q-btn",{attrs:{flat:"",color:"white"},on:{click:e.reduceGeolocBanner}},[e._v("\n          R√©duire\n        ")]),i("q-btn",{attrs:{flat:"",color:"white"},on:{click:e.retryLocate}},[e._v("\n          R√©essayer\n        ")])],1)])]):e._e(),e.noGeolocBannerReduced?i("q-page-sticky",{staticClass:"geolocErrorBtn",attrs:{position:"top-right",offset:e.posOffset}},[i("q-btn",{attrs:{fab:"",icon:"gps_off",color:"red",dense:"",size:"xs",padding:"xs"},on:{click:e.expandGeolocBanner}})],1):e._e()],1)},te=[],ie={name:"GeoLocErrorNotif",props:{showDialog:null},data:function(){return{store:K["a"],geolocationDisabled:!1,locationErrorText:"Veuillez v√©rifier vos param√®tres et autorisations.",noGeolocBannerReduced:!1,posOffset:[70,22]}},created:function(){},computed:{isRetryLocate:function(){return this.store.state.isRetryLocate},geolocDisabled:function(){return this.store.state.geolocDisabled},isNavigationImage:function(){return this.store.state.isNavigationImage},isInterior:function(){return this.store.state.isInterior}},watch:{geolocDisabled:function(e){this.geolocationDisabled=e},isInterior:function(e){e&&this.geolocDisabled&&(this.noGeolocBannerReduced=!0)},isNavigationImage:function(e){if(this.posOffset=[70,22],e&&this.geolocDisabled){this.noGeolocBannerReduced=!0;var t=this;setTimeout((function(){var e=document.getElementById("navImageContainer").offsetHeight,i=22+e;t.posOffset=[70,i]}),500)}}},methods:{retryLocate:function(){this.store.commit("setRetryLocate",!0)},reduceGeolocBanner:function(){this.noGeolocBannerReduced=!0},expandGeolocBanner:function(){this.noGeolocBannerReduced=!1}}},ne=ie,oe=i("2877"),se=i("eebe"),re=i.n(se),ae=i("54e1"),le=i("9c40"),ce=i("de5e"),de=Object(oe["a"])(ne,ee,te,!1,null,null,null),ue=de.exports;re()(de,"components",{QBanner:ae["a"],QBtn:le["a"],QPageSticky:ce["a"]});var pe=i("2b0e"),he=i("11a1"),me=i("3f3d");function ge(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function fe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(i),!0).forEach((function(t){d()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ge(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ye(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=ve(e))){var t=0,i=function(){};return{s:i,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,s=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function ve(e,t){if(e){if("string"===typeof e)return Ie(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ie(e,t):void 0}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}pe["default"].use(he["a"]);var be={props:["type"],components:{MglMap:me["b"],MglAttributionControl:me["a"],MglNavigationControl:me["c"],MglScaleControl:me["d"],GeoLocErrorNotif:ue},data:function(){return{store:K["a"],accessToken:"pk.eyJ1IjoianVseXVzcyIsImEiOiJja2E2amxxOW0wN245MnhvaHU5OHRrM25rIn0.JFf7wbHPb7AwEvXK45h47g",mapStyle:"mapbox://styles/mapbox/light-v10",zoom:parseFloat("13.25"),minZoom:0,maxZoom:17.5,maxZoomInterior:22,center:[parseFloat("3.153204729474396"),parseFloat("50.21899024777983")],selectedElement:"",imageList:[],isMapLoaded:!1,shapesGeojson:null,isTreeSelectLoaded:!1,isLoading:!0,loadingText:"Chargement en cours...",locationErrorText:"Veuillez v√©rifier vos param√®tres et autorisations.",infoName:"",infoShortName:"",expandedInfo:!1,itineraryStartEltId:-1,routePath:null,noZoom:!1,userPos:null,selectedElementId:null,userLocation:{latitude:null,longitude:null},displayedEltsType:null,descGroups:[],descImagesLoaded:!1,displayedImages:[],isInfoOnTransition:!1,isDefaultTypeIcon:!0,dictIconById:new Map,isGeolocChecked:!1,isShapesLoaded:!1,isURLChecked:!1,isFullPageLoading:!1,selectedFeat:null,selectedDestFeat:null,currentPopup:null,isClickedPopup:!1,interiorPolygon:null,isNoInteraction:!1,isNavBtnDisplayed:!0,isTypesFiltered:!0,loadedShapesSelectedType:null,loadedShapesAllTypes:null,isElementSelected:!1,currentFloor:0,elevatorTotalFloors:1,buildingFloors:[]}},created:function(){this.geolocateTimerFreq=500;var e=document.createElement("div");e.className="endMarkerIcon",this.endMarker=new k.a.Marker({element:e,anchor:"bottom"});var t=document.createElement("div");t.className="startMarkerIcon",this.startMarker=new k.a.Marker({element:t,anchor:"center",pitchAlignment:"map"});var i=document.createElement("div");i.className="locNavMarkerIcon",this.locNavMarker=new k.a.Marker({element:i,anchor:"center",pitchAlignment:"map",rotationAlignment:"map"});var n=document.createElement("div");n.className="locMarkerIcon",this.locMarker=new k.a.Marker({element:n,anchor:"center",pitchAlignment:"map",rotationAlignment:"map"});var o=document.createElement("div");n.className="locMarkerIcon",this.locPreviewMarker=new k.a.Marker({element:o,anchor:"center",pitchAlignment:"map",rotationAlignment:"map"});var s=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(s,"px"));var r=this;window.addEventListener("orientationchange",(function(e){setTimeout((function(){r.resizeMap()}),500)})),window.addEventListener("resize",(function(e){r.map&&setTimeout((function(){r.setMapMaxHeight()}),500)}))},beforeDestroy:function(){clearInterval(this.geolocateTimer)},computed:{isRetryLocate:function(){return this.store.state.isRetryLocate},itineraryStartTreeElt:function(){return this.store.state.itineraryStartTreeElt},isTreeSelectOpen:function(){return this.store.state.isTreeSelectOpen},styleByTypeId:function(){return this.store.state.styleByTypeId},isDirections:{get:function(){return this.store.state.isDirectionMode},set:function(e){this.store.commit("setDirectionMode",e)}},selectedTreeElement:{get:function(){return this.store.state.selectedTreeElement},set:function(e){this.store.commit("setSelectedTreeElement",e)}},isNavigation:{get:function(){return this.store.state.isNavigationMode},set:function(e){this.store.commit("setNavigationMode",e)}},isInterior:{get:function(){return this.store.state.isInterior},set:function(e){this.store.commit("setInterior",e)}},isPreview:{get:function(){return this.store.state.isPreview},set:function(e){this.store.commit("setPreview",e)}},isGeolocDisabled:{get:function(){return this.store.state.geolocDisabled},set:function(e){this.store.commit("setGeolocDisabled",e)}},selectDepartureOnMap:{get:function(){return this.store.state.selectDepartureOnMap},set:function(e){this.store.commit("setSelectDepartureOnMap",e)}},selectArrivalOnMap:{get:function(){return this.store.state.selectArrivalOnMap},set:function(e){this.store.commit("setSelectArrivalOnMap",e)}},isNoDirectionOnChange:{get:function(){return this.store.state.isNoDirectionOnChange},set:function(e){this.store.commit("setNoDirectionOnChange",e)}},isNavigationImage:{get:function(){return this.store.state.isNavigationImage},set:function(e){this.store.commit("setNavigationImage",e)}},remainingDistance:{get:function(){return this.store.state.remainingDistance},set:function(e){this.store.commit("setRemainingDistance",e)}},isShowQrCode:{get:function(){return this.store.state.isShowQrCode},set:function(e){this.store.commit("setShowQrDialog",e)}},qrCodeURL:{get:function(){return this.store.state.qrCodeURL},set:function(e){this.store.commit("setQrCodeURL",e)}},interiorId:{get:function(){return this.store.state.interiorId},set:function(e){this.store.commit("setInteriorId",e)}},eltsPropsById:{get:function(){return this.store.state.eltsPropsById},set:function(e){this.store.commit("setEltsPropsById",e)}}},watch:{isTypesFiltered:function(e){if(this.selectedTreeElement){var t=parseInt(this.selectedTreeElement.toString().split("-")[0]),i=["case",["all",["literal",this.isInterior],["literal",e]],["==",["get","typeId"],["literal",t]],["literal",this.isInterior],["all",[">=",["zoom"],["to-number",["get","minZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]],["<=",["zoom"],["to-number",["get","maxZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]]],!0];this.map.setFilter("buildings",i),this.map.setFilter("elementLabels",i)}},isGeolocDisabled:function(e){this.setMapMaxHeight()},isRetryLocate:function(e){this.locateMe()},isTreeSelectOpen:function(e){e&&(this.expandedInfo=!1)},currentFloor:function(e){document.documentElement.style.setProperty("--elevator_label",'"'+this.buildingFloors[this.currentFloor]+'"')},isDirections:function(e){e?this.hideUserLoc():(this.map.getSource("directionPath").setData({type:"Feature",geometry:null}),this.isNavigation||this.isPreview||(this.endMarker.remove(),this.startMarker.remove(),this.selectedTreeElement=null)),this.setMapMaxHeight(),this.currentPopup&&this.currentPopup._onClose()},isNavigation:function(e){e||(this.map.getSource("directionPathNavigation").setData({type:"Feature",geometry:null}),this.map.getSource("navDestination").setData({type:"Feature",geometry:null}),this.isDirections||(this.endMarker.remove(),this.startMarker.remove(),this.locNavMarker.remove(),this.selectedTreeElement=null,this.unselectElement(),this.map.setPitch(0)),this.isNavigationImage&&(document.getElementById("navigationImage").remove(),this.isNavigationImage=!1)),this.setMapMaxHeight()},isPreview:function(e){e||(this.map.getSource("directionPathNavigation").setData({type:"Feature",geometry:null}),this.map.getSource("navDestination").setData({type:"Feature",geometry:null}),this.isDirections||(this.endMarker.remove(),this.startMarker.remove(),this.selectedTreeElement=null,this.unselectElement(),this.locPreviewMarker.remove()),this.isNavigationImage&&(document.getElementById("navigationImage").remove(),this.isNavigationImage=!1)),this.setMapMaxHeight()},isInterior:function(e){e||this.map.setMaxBounds(null);var t=[];if(this.selectedTreeElement){var i=parseInt(this.selectedTreeElement.toString().split("-")[0]);t=["case",["all",["literal",e],["literal",this.isTypesFiltered]],["==",["get","typeId"],["literal",i]],["literal",e],["all",[">=",["zoom"],["to-number",["get","minZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]],["<=",["zoom"],["to-number",["get","maxZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]]],!0]}else t=["case",["literal",e],["all",[">=",["zoom"],["to-number",["get","minZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]],["<=",["zoom"],["to-number",["get","maxZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]]],!0];this.map.setFilter("buildings",t),this.map.setFilter("elementLabels",t)},userLocation:{deep:!0,handler:function(e){if(this.isNavigation){var t=Object(q["point"])([e.longitude,e.latitude]),i=j()(this.routePath,t),n=this.routePath.features[0].geometry.coordinates,o=Object(q["point"])(n[n.length-1]),s=Object(q["lineString"])(this.routePath.features[0].geometry.coordinates),r=Object(_["a"])(i,o,s),a=V()(r);if(this.remainingDistance=+a.toPrecision(2),this.easeMarkerTo(i),this.selectedTreeElement.toString().includes("-")&&-1!==this.selectedTreeElement&&a<.5&&!this.isNavigationImage){var l=this.selectedTreeElement.toString().split("-")[1];this.addNavigationImage(l)}}}},itineraryStartTreeElt:function(e){if(e){if("-1"===e.toString()?this.isNavBtnDisplayed=!0:this.isNavBtnDisplayed=!1,this.itineraryStartEltId=e.toString().includes("-")&&parseInt(e)>0?parseInt(e.split("-")[1]):e,this.isDirections&&this.selectedTreeElement.toString().includes("-")){var t=this.selectedTreeElement.toString().includes("-")&&parseInt(this.selectedTreeElement)>0?parseInt(this.selectedTreeElement.split("-")[1]):this.selectedTreeElement;this.getDirections(this.itineraryStartEltId,t)}}else void 0!==this.map&&this.selectDepartureOnMap&&(this.loadShapesByType(this.selectDepartureOnMap),this.displayedEltsType=this.selectDepartureOnMap)},selectedTreeElement:function(e){if(this.isTreeSelectLoaded=!0,e&&void 0!==this.map&&"-1"!==e.toString()){if(e.toString().includes("-")){this.expandedInfo=!1;var t=e.toString().includes("-")&&parseInt(e)>0?parseInt(e.split("-")[1]):e;(!this.displayedEltsType||this.displayedEltsType!==e.toString().split("-")[0])&!this.isInterior?this.loadShapesByType(e.toString().split("-")[0],t):(this.selectElement(t),this.isTypesFiltered=!0)}else{if(!this.isNavigation)if((!this.displayedEltsType||this.displayedEltsType!==e)&!this.isInterior)this.loadShapesByType(e);else{var i=C()(this.shapesGeojson);this.map.fitBounds([[i[0],i[1]],[i[2],i[3]]]),this.isTypesFiltered=!0,this.unselectShape()}this.closeInfoBanner()}this.displayedEltsType=e.toString().split("-")[0];var n=parseInt(e.toString().split("-")[0]),o=["case",["all",["literal",this.isInterior],["literal",this.isTypesFiltered]],["==",["get","typeId"],["literal",n]],["literal",this.isInterior],["all",[">=",["zoom"],["to-number",["get","minZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]],["<=",["zoom"],["to-number",["get","maxZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]]],!0];this.map.setFilter("buildings",o),this.map.setFilter("elementLabels",o)}else e&&"-1"===e.toString()?this.getDirections(this.itineraryStartEltId,"-1"):void 0===e&&void 0!==this.map&&this.selectArrivalOnMap&&(this.loadShapesByType(this.selectArrivalOnMap),this.displayedEltsType=this.selectArrivalOnMap)}},methods:{load:function(e){var t=this,i=e.map;this.map=i,this.map.addSource("GIGN",{type:"raster",tiles:["https://wxs.ign.fr/choisirgeoportail/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE=normal&TILEMATRIXSET=PM&FORMAT=image/png&LAYER=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}"],tileSize:200,minzoom:0,maxzoom:18}),this.map.addLayer({id:"GIGN",type:"raster",source:"GIGN",minzoom:0,maxzoom:20}),this.isMapLoaded=!0,this.setLoading(!0,"Chargement des images...");var n="https://privamap-dev.azurewebsites.net/api/imageLayer/all",o={method:"GET",redirect:"follow"};fetch(n,o).then((function(e){return e.text()})).then((function(e){JSON.parse(e).ImageLayers&&(t.imageList=JSON.parse(e).ImageLayers),t.addAllImages(),t.addElementsLayer(),t.setLoading(!0,"Chargement des √©l√©ments..."),t.loadShapesByType(t.selectedTreeElement)})).catch((function(e){return console.log("error",e)}));var s=this;this.map.on("dragend",(function(){if(s.isInterior){var e=s.map.getCenter(),t=Object(q["point"])([e.lng,e.lat]);if(null!==s.interiorPolygon&&!X()(t,s.interiorPolygon)){var i=W()(s.interiorPolygon),n=j()(i,t);s.map.panTo(n.geometry.coordinates,{duration:1e3})}}})),navigator.geolocation?navigator.geolocation.getCurrentPosition(this.successGeolocation,this.errorGeolocation):this.isGeolocChecked=!0},selectElement:function(e){var t,i=this.map.getSource("buildings")._data.features,n=ye(i);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(e===parseInt(o.properties.elementId)){this.selectPolygon(o);var s=this.eltsPropsById.get(o.properties.elementId);if(this.dictIconById.has(s.typeId)){this.isDefaultTypeIcon=!1;var r=this.dictIconById.get(s.typeId);this.setAsTypeIcon(r)}else this.isDefaultTypeIcon=!0,this.loadTypeIcon(s.typeId);if(this.isDirections||this.isNavigation)this.isDirections&&this.itineraryStartTreeElt&&this.getDirections(this.itineraryStartEltId,e);else{if(!this.noZoom){var a=C()(o.geometry);this.map.fitBounds([[a[0],a[1]],[a[2],a[3]]],{padding:{top:10,bottom:30,left:20,right:20}})}this.isClickedPopup||(this.currentPopup&&this.currentPopup._onClose(),s.floors&&s.floor.length>0&&this.openPopupAt(s.center)),this.isClickedPopup=!1;var l=this;setTimeout((function(){l.showInfoBanner(o.properties.elementId,s.name,s.shortname,o.geometry.coordinates[0][0]),l.noZoom=!1}),0)}break}}}catch(c){n.e(c)}finally{n.f()}},loadTypeIcon:function(e){var t=this,i="https://privamap-dev.azurewebsites.net/api/elementType/"+e,n={method:"GET",redirect:"follow"};fetch(i,n).then((function(e){return e.text()})).then((function(i){if(i=JSON.parse(i),i.elementTypeStyle.icon){t.isDefaultTypeIcon=!1;var n="data:"+i.elementTypeStyle.icon.fileType+";base64,"+i.elementTypeStyle.icon.image;t.dictIconById.set(e,n),t.setAsTypeIcon(n)}else t.isDefaultTypeIcon=!0})).catch((function(e){return console.log("error",e)}))},setAsTypeIcon:function(e){var t=new XMLHttpRequest;t.open("GET",e);var i=this;t.addEventListener("load",(function(e){var t=e.target.response,n=new DOMParser,o=n.parseFromString(t,"image/svg+xml");o.rootElement.setAttribute("preserveAspectRatio","xMidYMid meet"),o.rootElement.id="infoBannerSVG",i.typeIcon="";var s=document.getElementById("infoBannerSVG"),r=s.parentNode;r.replaceChild(o.rootElement,s)})),t.send(null)},onClickBuilding:function(e){this.expandedInfo=!1,this.isDirections||(this.noZoom=!0);var t=e.features[0],i=this.eltsPropsById.get(t.properties.elementId);!this.isDirections&&!this.isNavigation&&i.floors&&i.floors.length>0&&this.openPopupAt(e.lngLat);var n=i.typeId+"-"+t.properties.elementId;this.isDirections||this.isNavigation||(this.selectedTreeElement=n),this.isDirections&&(this.selectArrivalOnMap?this.selectedTreeElement=n:this.selectDepartureOnMap&&this.store.commit("setItineraryStartTreeElt",n)),this.selectPolygon(t)},openPopupAt:function(e){this.isClickedPopup=!0,this.currentPopup=new P({closeButton:!1,anchor:"bottom",offset:[0,10]}),this.currentPopup.setLngLat(e);var t=document.getElementById("popupBtnContainer").cloneNode(!0);t.id="popupBtnContainerOpen",t.getElementsByTagName("button").item(0).onclick=this.enterBuilding,this.currentPopup.setDOMContent(t),this.currentPopup.addTo(this.map)},selectPolygon:function(e){this.isElementSelected=!0,this.selectedFeat=e,null!==this.selectedPolygonId&&this.map.removeFeatureState({source:"buildings",id:this.selectedPolygonId}),this.selectedPolygonId=e.id,this.map.setFeatureState({source:"buildings",id:this.selectedPolygonId},{clicked:!0})},showInfoBanner:function(e,t,i,n){var o=this;this.displayedImages=[],document.getElementById("infoBanner").style.visibility="visible",this.infoName=t,this.infoShortName=i;var s="https://privamap-dev.azurewebsites.net/api/element/"+e+"/descriptions",r={method:"GET",redirect:"follow"};fetch(s,r).then((function(e){return e.text()})).then((function(e){e=JSON.parse(e),o.descGroups=e.Descriptions,o.descGroups.sort(Se)})).catch((function(e){return console.log("error",e)})),this.setMapMaxHeight()},onClickCloseInfoBanner:function(){this.closeInfoBanner(),this.unselectElement()},closeInfoBanner:function(){this.expandedInfo=!1;for(var e=0;e<this.descGroups.length;e++)this.descGroups[e].isExpanded=!1;document.getElementById("infoBanner").style.visibility="hidden",this.setMapMaxHeight(),this.isInterior&&this.selectedTreeElement.toString().includes("-")&&(this.isTypesFiltered=!1)},unselectElement:function(){this.isElementSelected=!1,this.unselectShape(),this.selectedTreeElement=null,this.currentPopup&&this.currentPopup._onClose()},unselectShape:function(){null!==this.selectedPolygonId&&this.map.removeFeatureState({source:"buildings",id:this.selectedPolygonId})},toggleInfoDesc:function(){this.expandedInfo=!this.expandedInfo},centerMap:function(){var e=[parseFloat("3.176841877913972"),parseFloat("50.228915906493086")],t=[parseFloat("3.1289118208060813"),parseFloat("50.21034240381536")],i=new k.a.LngLatBounds(e,t);this.map.fitBounds(i)},addAllImages:function(){if(this.isMapLoaded)for(var e=null,t=0;t<this.imageList.length;t++)e={type:"image",url:"data:"+this.imageList[t].fileType+";base64,"+this.imageList[t].image,coordinates:[[parseFloat(this.imageList[t].topLeftLng),parseFloat(this.imageList[t].topLeftLat)],[parseFloat(this.imageList[t].topRightLng),parseFloat(this.imageList[t].topRightLat)],[parseFloat(this.imageList[t].bottomRightLng),parseFloat(this.imageList[t].bottomRightLat)],[parseFloat(this.imageList[t].bottomLeftLng),parseFloat(this.imageList[t].bottomLeftLat)]]},this.map.addSource("image"+this.imageList[t].id,e),this.map.addLayer({id:"imageLayer"+this.imageList[t].id,type:"raster",source:"image"+this.imageList[t].id,layout:{},paint:{"raster-opacity":1}})},addElementsLayer:function(){this.map.addSource("buildings",{type:"geojson",data:null});var e=parseInt(this.selectedTreeElement.toString().split("-")[0]),t=["case",["all",["literal",this.isInterior],["literal",this.isTypesFiltered]],["==",["get","typeId"],["literal",e]],["literal",this.isInterior],["all",[">=",["zoom"],["to-number",["get","minZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]],["<=",["zoom"],["to-number",["get","maxZoom",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]]]]],!0],i={id:"buildings",type:"fill",source:"buildings",filter:t,layout:{},paint:{"fill-color":["case",["boolean",["feature-state","clicked"],!1],"#2f52a0",["string",["get","color",["get",["to-string",["get","typeId"]],["literal",this.styleByTypeId]]],"#00CD9A"]],"fill-opacity":["case",["boolean",["feature-state","clicked"],!1],1,.8]}};this.map.addLayer(i),this.map.addSource("elementLabels",{type:"geojson",data:null});var n={id:"elementLabels",type:"symbol",source:"elementLabels",filter:t,layout:{"icon-image":"custom-marker","text-field":["get","shortname"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,0],"text-anchor":"center"},paint:{"text-color":"#FFFFFF","text-opacity":["case",["<",["get","area"],5500],0,1]},minzoom:13.5};this.map.addLayer(n);var o=this.map;this.map.on("mouseenter","buildings",(function(){o.getCanvas().style.cursor="pointer"})),this.map.on("mouseleave","buildings",(function(){o.getCanvas().style.cursor=""})),this.map.on("click","buildings",this.onClickBuilding),this.map.addSource("directionPath",{type:"geojson",data:null}),this.map.addLayer({id:"directionPath",type:"line",source:"directionPath",paint:{"line-color":"#00CD9A","line-width":7,"line-opacity":1},layout:{"line-cap":"round","line-join":"round"}}),this.map.addSource("directionPathNavigation",{type:"geojson",data:null}),this.map.addLayer({id:"directionPathNavigation",type:"fill",source:"directionPathNavigation",paint:{"fill-color":"#56BFEC","fill-opacity":1},layout:{}}),this.map.addSource("navDestination",{type:"geojson",data:null});var s={id:"navDestination",type:"fill",source:"navDestination",layout:{},paint:{"fill-color":"#fca311","fill-opacity":1}};this.map.addLayer(s);var r={id:"navDestinationBorderBack",type:"line",source:"navDestination",layout:{},paint:{"line-color":"#3d405b","line-width":3},minzoom:16.5};this.map.addLayer(r);var a={id:"navDestinationBorder",type:"line",source:"navDestination",layout:{},paint:{"line-color":"#e07a5f","line-width":3,"line-dasharray":[1,2]},minzoom:16.5};this.map.addLayer(a),this.map.addSource("posAccuracyCircle",{type:"geojson",data:null});var l={id:"posAccuracyCircle",type:"fill",source:"posAccuracyCircle",layout:{},paint:{"fill-color":"#61C1D2","fill-opacity":.4}};this.map.addLayer(l)},loadShapes:function(){var e=p()(l.a.mark((function e(t,i){var n,o,s=this;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.isMapLoaded||!this.isTreeSelectLoaded){e.next=5;break}return n={method:"GET",redirect:"follow"},e.next=4,fetch(t,n).then((function(e){return e.text()})).then((function(e){e=JSON.parse(e);for(var t=e.Elements,n={type:"FeatureCollection",features:[]},r={type:"FeatureCollection",features:[]},a=0;a<t.length;a++)for(var l=0;l<t[a].Shapes.length;l++){var c={type:"Feature",geometry:t[a].Shapes[l].json,id:t[a].Shapes[l].id,properties:{elementId:t[a].id,typeId:e.ElementTypeStyle?e.ElementTypeStyle.id:t[a].typeId}};n.features.push(c);var d=Q()(t[a].Shapes[l].json);d.properties.area=U()(t[a].Shapes[l].json),d.properties.shortname=t[a].shortname,d.properties.typeId=e.ElementTypeStyle?e.ElementTypeStyle.id:t[a].typeId,r.features.push(d);var u={name:t[a].name,shortname:t[a].shortname,typeId:e.ElementTypeStyle?e.ElementTypeStyle.id:t[a].typeId,indication:t[a].indication,center:d.geometry.coordinates};if(s.eltsPropsById.has(t[a].id)){var p=s.eltsPropsById.get(t[a].id);s.eltsPropsById.set(t[a].id,fe(fe({},p),u))}else s.eltsPropsById.set(t[a].id,u)}if(s.shapesGeojson=n,s.map.getSource("buildings").setData(s.shapesGeojson),s.map.getSource("elementLabels").setData(r),s.setLoading(!1),i||s.noZoom)i&&s.selectElement(i);else{s.noZoom=!1;var h=C()(s.shapesGeojson);s.map.fitBounds([[h[0],h[1]],[h[2],h[3]]]),s.currentPopup}s.isShapesLoaded=!0,s.isURLChecked||s.urlCheck(),o={shapes:n,centroids:r}})).catch((function(e){return console.log("error",e)}));case 4:return e.abrupt("return",o);case 5:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}(),loadShapesByType:function(){var e=p()(l.a.mark((function e(t,i){var n;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="https://privamap-dev.azurewebsites.net/api/elementType/"+t+"/elements",e.next=3,this.loadShapes(n,i);case 3:this.loadedShapesSelectedType=e.sent;case 4:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}(),loadShapesByParent:function(){var e=p()(l.a.mark((function e(t,i,n){var o;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.isFullPageLoading=!0,o="https://privamap-dev.azurewebsites.net/api/element/"+t+"/sons/"+i+"/",e.next=4,this.loadShapes(o,n);case 4:this.loadedShapesAllTypes=e.sent,this.isFullPageLoading=!1;case 6:case"end":return e.stop()}}),e,this)})));function t(t,i,n){return e.apply(this,arguments)}return t}(),resizeMap:function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px")),this.map.resize()},successGeolocation:function(e){var t=this;if(this.userLocation.latitude=e.coords.latitude,this.userLocation.longitude=e.coords.longitude,!this.isDirections&&!this.isNavigation&&e.coords.accuracy<500&&(this.locMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this.map),!this.isPreview)){var i=Object(D["a"])(Object(q["point"])([e.coords.longitude,e.coords.latitude]),e.coords.accuracy/1e3);this.map.getSource("posAccuracyCircle").setData(i)}this.isURLChecked||(this.isGeolocChecked=!0,this.urlCheck()),this.geolocateTimer||(console.log("launch geoloc"),this.geolocateTimer=setInterval((function(){navigator.geolocation.getCurrentPosition(t.successGeolocation,t.errorGeolocation)}),this.geolocateTimerFreq))},errorGeolocation:function(){this.isGeolocDisabled=!0,this.isURLChecked||(this.isGeolocChecked=!0,this.urlCheck())},setLoading:function(e,t){t&&(this.loadingText=t),this.isLoading=e,this.setMapMaxHeight()},locateMe:function(){var e=this;return p()(l.a.mark((function t(){return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.closeInfoBanner(),e.setLoading(!0,"Recherche de la position..."),e.isGeolocDisabled=!1,t.prev=3,t.next=6,e.getLocation();case 6:e.location=t.sent,e.setLoading(!1),e.store.commit("setRetryLocate",!1),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](3),e.setLoading(!1),e.reloadPage();case 15:case"end":return t.stop()}}),t,null,[[3,11]])})))()},getLocation:function(){return p()(l.a.mark((function e(){return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){"geolocation"in navigator||t(new Error("Geolocation is not available.")),navigator.geolocation.getCurrentPosition((function(t){e(t)}),(function(e){t(e)}))})));case 1:case"end":return e.stop()}}),e)})))()},reloadPage:function(){document.location.reload()},startDirection:function(e){this.isDirections=!0;var t=this.selectedTreeElement.toString().includes("-")&&parseInt(this.selectedTreeElement)>0?parseInt(this.selectedTreeElement.split("-")[1]):this.selectedTreeElement;this.getDirections(this.itineraryStartEltId,t),this.closeInfoBanner(),this.exitBuilding()},getDirections:function(e,t){var i=this;if(this.isNoDirectionOnChange)this.isNoDirectionOnChange=!1;else{this.isFullPageLoading=!0;var n="";if(e>0&&t>0)n="https://privamap-dev.azurewebsites.net/api/route/elm_"+e+"/elm_"+t;else{navigator.geolocation.getCurrentPosition(this.successGeolocation,this.errorGeolocation);var o=0,s=t;-1===parseInt(t)&&(o=1,s=e),n="https://privamap-dev.azurewebsites.net/api/route/"+this.userLocation.latitude+"/"+this.userLocation.longitude+"/elm_"+s+"/"+o}var r={method:"GET",redirect:"follow"};fetch(n,r).then((function(e){return e.text()})).then((function(e){if(i.isDirections){i.routePath=JSON.parse(e),i.map.getSource("directionPath").setData(i.routePath);var t=C()(i.routePath);i.map.fitBounds([[t[0],t[1]],[t[2],t[3]]],{padding:{top:10,bottom:30,left:20,right:20}});var n=i.routePath.features[0].geometry.coordinates;i.endMarker.setLngLat(n[n.length-1]).addTo(i.map),i.startMarker.setLngLat(n[0]).addTo(i.map),i.isFullPageLoading=!1}})).catch((function(e){return console.log("error",e)}))}},startPreview:function(){var e=p()(l.a.mark((function e(){var t;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.showNavElements(),t=this.routePath.features[0].geometry.coordinates[0],this.map.flyTo({center:t,zoom:Math.max(16,this.map.getZoom())}),this.isDirections=!1,this.isPreview=!0,console.log("this.locPreviewMarker"),console.log(this.locPreviewMarker),console.log("this.startMarker.getLngLat()"),console.log(this.startMarker.getLngLat()),this.locPreviewMarker.setLngLat(this.startMarker.getLngLat()).addTo(this.map);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),startNavigation:function(){var e=p()(l.a.mark((function e(){var t,i,n,o;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.showNavElements(),t=this.routePath.features[0].geometry.coordinates[0],i=Object(q["point"])(t),n=Object(q["point"])(this.routePath.features[0].geometry.coordinates[1]),o=O()(i,n),this.map.flyTo({center:t,zoom:17,pitch:60,bearing:o}),this.locNavMarker.setRotation(o),this.isDirections=!1,this.isNavigation=!0,this.locNavMarker.setLngLat(this.startMarker.getLngLat()).addTo(this.map);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),showNavElements:function(){var e=p()(l.a.mark((function e(){var t,i,n,o,s,r,a,c,d,u,p,h;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=Object(D["a"])(this.routePath,.003),this.map.getSource("directionPathNavigation").setData(t.features[0]),!this.selectedTreeElement.toString().includes("-")||-1===this.selectedTreeElement){e.next=37;break}if(i=this.selectedTreeElement.toString().split("-")[1],"2"!==this.selectedTreeElement.toString().split("-")[0]){e.next=29;break}return this.noZoom=!0,e.next=8,this.loadShapesByType(this.selectedTreeElement.toString().split("-")[0]);case 8:this.displayedEltsType=this.selectedTreeElement.toString().split("-")[0],n=this.map.getSource("buildings")._data.features,o=ye(n),e.prev=11,o.s();case 13:if((s=o.n()).done){e.next=20;break}if(r=s.value,parseInt(r.properties.elementId)!==parseInt(i)){e.next=18;break}return this.selectedDestFeat=r,e.abrupt("break",20);case 18:e.next=13;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](11),o.e(e.t0);case 25:return e.prev=25,o.f(),e.finish(25);case 28:this.map.getSource("navDestination").setData(this.selectedDestFeat);case 29:a=this.routePath.features[0].geometry.coordinates,c=Object(q["point"])(a[0]),d=Object(q["point"])(a[a.length-1]),u=Object(q["lineString"])(this.routePath.features[0].geometry.coordinates),p=Object(_["a"])(c,d,u),h=V()(p),this.remainingDistance=+h.toPrecision(2),h<.5&&this.addNavigationImage(i);case 37:case"end":return e.stop()}}),e,this,[[11,22,25,28]])})));function t(){return e.apply(this,arguments)}return t}(),addNavigationImage:function(e){var t=this,i="https://privamap-dev.azurewebsites.net/api/element/"+e+"/navigation",n={method:"GET",redirect:"follow"};fetch(i,n).then((function(e){return e.text()})).then((function(e){var i=JSON.parse(e);if(i.image){var n="data:"+i.fileType+";base64,"+i.image,o=t.eltsPropsById.get(t.selectedDestFeat.properties.elementId),s=n,r=new XMLHttpRequest,a=t;r.open("GET",s),r.addEventListener("load",(function(e){var t=e.target.response,i=new DOMParser,n=i.parseFromString(t,"image/svg+xml");n.rootElement.id="navigationImage";var s=n.querySelectorAll('*[id^="dock_"]');s.forEach((function(e,t,i){e.innerHTML=parseInt(o.indication)+parseInt(e.id.split("_")[1])})),n.rootElement.setAttribute("preserveAspectRatio","xMidYMid meet"),!a.isNavigationImage&&a.isNavigation&&(document.getElementById("navImageContainer").prepend(n.rootElement),a.isNavigationImage=!0,setTimeout((function(){a.setMapMaxHeight()}),500))})),r.send(null)}})).catch((function(e){return console.log("error",e)}))},easeMarkerTo:function(e){var t=this.locNavMarker.getLngLat(),i=Object(q["point"])([t.lng,t.lat]),n=Object(q["point"])(e.geometry.coordinates),o=Object(q["lineString"])(this.routePath.features[0].geometry.coordinates);this.markerRoute=Object(_["a"])(i,n,o),this.isBacktracking=!1;var s=j()(this.routePath,i),r=j()(this.routePath,n);s.properties.location>r.properties.location&&(this.isBacktracking=!0);var a=Te(this.markerRoute);if(!(a<.003)){var l=[];this.markerAnimSteps=50;for(var c=0;c<a;c+=a/this.markerAnimSteps){var d=A()(this.markerRoute,c);this.isBacktracking?l.unshift(d.geometry.coordinates):l.push(d.geometry.coordinates)}this.markerRoute.geometry.coordinates=l,this.counter=0,this.animateMarker(this.counter)}},animateMarker:function(){this.locNavMarker.setLngLat(this.markerRoute.geometry.coordinates[this.counter]);var e,t=Object(q["point"])(this.markerRoute.geometry.coordinates[this.counter>=this.markerAnimSteps?this.counter-1:this.counter]),i=Object(q["point"])(this.markerRoute.geometry.coordinates[this.counter>=this.markerAnimSteps?this.counter:this.counter+1]);e=this.isBacktracking?O()(i,t):O()(t,i),this.locNavMarker.setRotation(e),this.map.easeTo({center:this.markerRoute.geometry.coordinates[this.counter],bearing:e}),this.counter<this.markerAnimSteps&&requestAnimationFrame(this.animateMarker),this.counter=this.counter+1},loadDescImages:function(e,t){var i=this;if(this.isInfoOnTransition=!0,this.displayedImages=[],this.descGroups[t].images)this.displayedImages=this.descGroups[t].images;else{this.descImagesLoaded=!1;var n="https://privamap-dev.azurewebsites.net/api/description/"+e+"/pictures",o={method:"GET",redirect:"follow"};fetch(n,o).then((function(e){return e.text()})).then((function(e){e=JSON.parse(e),i.displayedImages=e.Pictures,i.descGroups[t].images=e.Pictures,i.descImagesLoaded=!0})).catch((function(e){return console.log("error",e)}))}},urlCheck:function(){if(this.$route.params.destId&&this.isGeolocChecked&&this.isShapesLoaded){this.isURLChecked=!0;var e=this.$route.params.destId;if(e.split("-").length>1){var t=-1;this.isGeolocDisabled&&(t="1-112");var i=parseInt(e.split("-")[1]);this.selectedTreeElement=e,this.store.commit("setItineraryStartTreeElt",t),this.store.commit("setDirectionMode",!0),this.getDirections(t,i)}}},shareQrCode:function(){this.qrCodeURL="/#/to"+this.selectedTreeElement,this.isShowQrCode=!0},centerUserLoc:function(){var e=this.map.getSource("posAccuracyCircle")._data,t=C()(e);this.map.fitBounds(t)},hideUserLoc:function(){this.locMarker.remove(),this.map.getSource("posAccuracyCircle").setData({type:"Feature",geometry:null})},enterBuilding:function(){var e=p()(l.a.mark((function e(){var t,i,n;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.currentPopup._onClose(),t=this.selectedTreeElement.split("-")[1],this.interiorId=t,e.next=5,this.loadBuildingFloors(t);case 5:this.buildingFloors&&this.buildingFloors.length>0&&this.loadShapesByParent(t,this.buildingFloors[0]),this.isTypesFiltered=!1,i=C()(this.selectedFeat.geometry),this.isNoInteraction=!0,this.map.setMaxZoom(this.maxZoomInterior),this.map.fitBounds([[i[0],i[1]],[i[2],i[3]]],{linear:!0,animate:!0,padding:{top:15,bottom:15,left:15,right:15},pan:{duration:1e3}}),this.interiorPolygon=this.selectedFeat.geometry,n=this,setTimeout((function(){n.map.setMinZoom(n.map.getZoom()),n.map.setMaxBounds(n.map.getBounds()),n.isNoInteraction=!1}),1050),this.closeInfoBanner(),this.unselectElement(),this.isInterior=!0;case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),exitBuilding:function(){this.isInterior=!1,this.map.setMinZoom(this.minZoom),this.map.setMaxZoom(this.maxZoom),this.noZoom=!0},loadBuildingFloors:function(){var e=p()(l.a.mark((function e(t){return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=parseInt(t),this.buildingFloors=[0],this.eltsPropsById.has(t)&&this.eltsPropsById.get(t).floors&&(this.buildingFloors=this.eltsPropsById.get(t).floors),this.elevatorTotalFloors=this.buildingFloors.length,console.log("this.buildingFloors"),console.log(this.buildingFloors);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),onFloorChange:function(){this.loadShapesByParent(this.interiorId,this.buildingFloors[this.currentFloor])},setMapMaxHeight:function(){var e=0,t=16;"hidden"!==document.getElementById("infoBanner").style.visibility&&!1===this.expandedInfo||this.isLoading?(e+=54,t+=54):"hidden"!==document.getElementById("infoBanner").style.visibility&&!0===this.expandedInfo&&(e+=document.getElementById("infoBanner").offsetHeight,t+=54);var i=document.getElementById("upperToolbar").offsetHeight;if(e+=i,t+=i,this.isNavigationImage){var n=document.getElementById("navImageContainer").offsetHeight;e+=n?n+6:150}document.getElementById("mapElement").style.height="calc(100vh - 16px - "+e+"px)",document.getElementById("mapElement").style.height="calc(var(--vh, 1vh) * 100 - 16px - "+e+"px)",document.documentElement.style.setProperty("--elth","".concat(t,"px")),this.map.resize()}}};function Te(e){var t=0;if(e.geometry.coordinates&&e.geometry.coordinates.length>0)for(var i=e.geometry.coordinates,n=0;n<i.length-1;n++){var o=Object(q["point"])(i[n]),s=Object(q["point"])(i[n+1]),r=G()(o,s);t+=r}return t}function Se(e,t){return e.priority<t.priority?-1:e.priority>t.priority?1:0}var Ee=be,Le=i("9989"),Be=i("f09f"),ke=i("c1d0"),we=i("cf57"),xe=i("3b73"),Pe=i("4074"),Me=i("0016"),Ce=i("a370"),De=i("1c1c"),Ne=i("068f"),Oe=i("293e"),Fe=i("eb85"),Ge=i("9564"),Re=i("74f7"),Ae=Object(oe["a"])(Ee,s,r,!1,null,null,null),qe=Ae.exports;re()(Ae,"components",{QPage:Le["a"],QCard:Be["a"],QPageSticky:ce["a"],QSlider:ke["a"],QBtn:le["a"],QBanner:ae["a"],QSpinnerGears:we["a"],QExpansionItem:xe["a"],QItemSection:Pe["a"],QIcon:Me["a"],QCardSection:Ce["a"],QList:De["a"],QImg:Ne["a"],QSkeleton:Oe["a"],QSeparator:Fe["a"],QToggle:Ge["a"],QInnerLoading:Re["a"]});var ze={components:{"map-component":qe},name:"PageIndex"},je=ze,_e=Object(oe["a"])(je,n,o,!1,null,null,null);t["default"]=_e.exports;re()(_e,"components",{QPage:Le["a"]})},cb43:function(e,t,i){}}]);